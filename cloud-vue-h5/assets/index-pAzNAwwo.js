import{r as p,o as K,a as C,e as o,w as r,f as l,J as S,u as T,i as G,F as H,q as Q,A as v,x as _,K as L,L as f,j as y,v as W,b as c,M as X,O as A,t as m,h as V,N as Y,P as Z}from"./index-CUGguU5z.js";import{U as ee,e as se}from"./excel-Des7eWoj.js";import{d as te}from"./hooks-B8RcsGp2.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ne={class:"task-list"},oe=["onClick"],ae={class:A(["van-ellipsis","cell-cust-line"])},le={class:A(["left","van-cell__title"])},ie={style:{"margin-right":"5px"}},ce={class:"time"},ue={key:0},re={class:"time"},me={__name:"index",setup(de){const b=G();let i=p(!1);const w=p([]),k=p(!1),h=p(!1),u=async()=>{h.value=!0,v.getTaskList().then(n=>{w.value=n||[];let e=n.map(s=>s.id);console.log("ids >>>",JSON.stringify(e))}).finally(()=>{h.value=!1,k.value=!1})},R=()=>{k.value=!0,u()},U=n=>{console.log("importData >>>>>:",n);let e=[];n.forEach(s=>{if(s.account)s.account=String(s.account);else{const x=s.login_name.split("@");s.account=x[0]}s.save_path_id=String(s.save_path_id),e.push(v.createTask(s))}),Promise.all(e).finally(()=>{i.value=!1,_({type:"success",message:"导入成功",duration:1e3}),u()})},B=()=>{se.exportToExcel(w.value,"任务列表.xlsx"),i.value=!1},a=p({}),d=p(!1),E=[{name:"查看链接",icon:"link-o"},{name:"立即执行",icon:"play-circle-o"},{name:"暂停/执行",icon:"pause-circle-o"},{name:"编辑任务",icon:"edit"},{name:"删除任务",icon:"delete-o",color:"#ee0a24"}],$=n=>{a.value=n,d.value=!0},D=n=>{if(n.name=="查看链接"){let s=a.value.share_url||"https://cloud.189.cn/t/"+a.value.share_code;d.value=!1,Z(()=>{window.open(s)});return}const e=L({message:"加载中...",forbidClick:!0,duration:0});if(n.name==="删除任务"&&v.deleteTask({list:[a.value.id]}).then(()=>{a.value={},u(),_({type:"success",message:"删除成功",duration:1e3}),d.value=!1}).finally(()=>{f(e)}),n.name==="暂停/执行"){const s=a.value.status==1?0:1;v.updateTask({id:a.value.id,status:s}).then(()=>{a.value={},u(),_({type:"success",message:"状态已切换为："+(s==0?"暂停":"执行"),duration:1e3}),d.value=!1}).finally(()=>{f(e)})}n.name==="立即执行"&&v.runTask({id:a.value.id}).then(s=>{a.value={},u(),_({type:"success",message:s.res_message,duration:1e3}),d.value=!1,console.log("res >>>>>:",s)}).finally(()=>{f(e)}),n.name=="编辑任务"&&(b.push({path:"/home/task/create",query:{id:a.value.id}}),f(e))},N=n=>{let e="";n=="account"&&(e=window.localStorage.getItem("account"));const s=L({message:"加载中...",forbidClick:!0,duration:0});v.runAllTask({account:e}).then(()=>{u(),_({type:"success",message:"执行成功",duration:1e3}),i.value=!1}).finally(()=>{f(s)})};return K(()=>{u()}),(n,e)=>{const s=l("van-icon"),x=l("van-nav-bar"),M=l("van-sticky"),g=l("van-cell"),O=l("van-cell-group"),P=l("van-popup"),j=l("van-swipe-cell"),q=l("van-list"),z=l("van-pull-refresh"),F=l("van-back-top"),I=l("van-action-sheet");return y(),C("div",ne,[o(M,null,{default:r(()=>[o(x,{title:"订阅任务"},{right:r(()=>[o(s,{name:"bars",size:"18",onClick:e[0]||(e[0]=t=>S(i)?i.value=!0:i=!0)})]),_:1})]),_:1}),o(P,{show:T(i),"onUpdate:show":e[5]||(e[5]=t=>S(i)?i.value=t:i=t),position:"right",style:{width:"70%",height:"100%"}},{default:r(()=>[o(O,null,{default:r(()=>[o(g,{title:"新建任务","is-link":"",onClick:e[1]||(e[1]=t=>T(b).push("/home/task/create")),icon:"plus"}),o(ee,{onOk:U,style:{width:"100%"}}),o(g,{title:"导出任务","is-link":"",icon:"revoke",onClick:e[2]||(e[2]=t=>B())}),o(g,{title:"执行当前账号任务","is-link":"",icon:"records-o",onClick:e[3]||(e[3]=t=>N("account"))}),o(g,{title:"执行所有账号任务","is-link":"",icon:"records-o",onClick:e[4]||(e[4]=t=>N(""))})]),_:1})]),_:1},8,["show"]),o(z,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t),onRefresh:R},{default:r(()=>[o(q,{loading:h.value,"onUpdate:loading":e[6]||(e[6]=t=>h.value=t),"finished-text":"没有更多了,右上角添加任务",onLoad:u,finished:!0},{default:r(()=>[(y(!0),C(H,null,Q(w.value,(t,J)=>(y(),W(j,{key:t.id},{right:r(()=>e[10]||(e[10]=[])),default:r(()=>[c("div",{class:"cell-cust",onClick:X(()=>$(t),["stop"])},[c("div",ae,[c("div",null,[c("div",le,[c("span",ie,m(J+1)+".",1),c("span",null,m(t.task_name),1),c("span",ce,[V("（已更: "+m(t.episode)+" ",1),t.episode_total?(y(),C("span",ue," / "+m(t.episode_total),1)):Y("",!0),e[9]||(e[9]=V(" ）"))])])]),c("div",re,[c("span",null,m(T(te)(t.update_time).fromNow()),1)])])],8,oe)]),_:2},1024))),128))]),_:1},8,["loading"])]),_:1},8,["modelValue"]),o(F),o(I,{show:d.value,"onUpdate:show":e[8]||(e[8]=t=>d.value=t),actions:E,onSelect:D,title:"操作"},null,8,["show"])])}}};export{me as default};
