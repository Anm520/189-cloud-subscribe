import{r as m,S as F,o as A,a as M,e as t,x as C,O as S,w as n,f as u,u as o,j as P,b as j,i as p,A as g,y as c,k as U}from"./index-CS16L17F.js";import{_ as E,F as L}from"./FloderSelect-CZmjikqR.js";import"./hooks-B4fckOQo.js";import"./_commonjsHelpers-Cpj98o6Y.js";const O={style:{margin:"16px"}},Q={__name:"CreateTask",props:{shareUrl:{type:String,default:""}},emits:["close"],setup(w,{emit:D}){const h=w,R=D,k=P(),d=F(),T=m(d.query.id?"编辑任务":"创建任务"),_=m(!1);let l=m({share_url:"",share_code:"",task_name:"",share_id:"",share_file_id:"",save_path_id:"",status:1,share_mode:3,save_type:0,episode_total:0,episode:0});const v=r=>{let e="";if(r?(e=l.value.share_url&&l.value.share_url.match(/\/t\/([^\/]+)/)[1]||"",l.value.share_code=e):e=l.value.share_code,console.log("shareCode",e),!e)return c({type:"warning",message:"请输入分享链接或分享码",duration:1e3});g.getShareInfoByCode({shareCode:e}).then(y=>{const{shareMode:b,shareId:I,fileId:s,fileName:i}=y;l.value.share_id=String(I),l.value.share_mode=b,l.value.share_file_id=s,l.value.task_name=i})},f=m(!1),V=m(!1),$=r=>{_.value=!0,l.value.id?(console.log("updateTask >>>>>:",l.value),g.updateTask(l.value).then(e=>{c({type:"success",message:"保存成功",duration:1e3}),k.back()}).finally(()=>{_.value=!1})):g.createTask({...r,account:r.account?r.account:window.localStorage.getItem("account")}).then(e=>{c({type:"success",message:"创建成功",duration:1e3}),h.shareUrl?R("close"):k.back()}).finally(()=>{_.value=!1})},x=()=>{d.query&&d.query.id&&g.getTaskDetail({id:d.query.id}).then(r=>{l.value={...r}}),d.query&&d.query.url&&(console.log("123",d.query.url),l.value.share_url=d.query.url,v(!0)),h.shareUrl&&(l.value.share_url=h.shareUrl,v(!0))};return A(()=>{x()}),(r,e)=>{const y=u("van-icon"),b=u("van-nav-bar"),I=u("van-sticky"),s=u("van-field"),i=u("van-radio"),q=u("van-radio-group"),N=u("van-cell-group"),B=u("van-button"),z=u("van-form");return U(),M("div",null,[t(I,null,{default:n(()=>[t(b,{title:T.value,"left-arrow":"",onClickLeft:e[1]||(e[1]=a=>o(k).back())},{right:n(()=>[t(y,{name:"bars",size:"18",onClick:e[0]||(e[0]=a=>r.showRight=!0)})]),_:1},8,["title"])]),_:1}),t(z,{onSubmit:$,style:{"margin-top":"10px"},required:"auto"},{default:n(()=>[t(N,{inset:""},{default:n(()=>[t(s,{modelValue:o(l).share_url,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).share_url=a),name:"share_url",label:"分享链接",placeholder:"分享链接","right-icon":"search",onClickRightIcon:e[3]||(e[3]=a=>v(!0))},null,8,["modelValue"]),t(s,{modelValue:o(l).share_code,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).share_code=a),name:"share_code",label:"share_code",placeholder:"share_code",rules:[{required:!0,message:"请填写share_code"}],"right-icon":"search",onClickRightIcon:e[5]||(e[5]=a=>v(!1))},null,8,["modelValue"]),t(s,{modelValue:o(l).task_name,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).task_name=a),name:"task_name",label:"任务名称",placeholder:"任务名称"},null,8,["modelValue"]),t(s,{modelValue:o(l).share_id,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).share_id=a),name:"share_id",label:"分享ID",placeholder:"分享ID",rules:[{required:!0,message:"请填写分享ID"}]},null,8,["modelValue"]),t(s,{modelValue:o(l).share_file_id,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).share_file_id=a),name:"share_file_id",label:"分享目录ID",placeholder:"分享目录ID",rules:[{required:!0,message:"请填写分享目录ID"}],"right-icon":"search",onClickRightIcon:e[9]||(e[9]=a=>f.value=!0)},null,8,["modelValue"]),t(s,{modelValue:o(l).share_mode,"onUpdate:modelValue":e[10]||(e[10]=a=>o(l).share_mode=a),name:"share_mode",label:"分享模式",placeholder:"3-pc,5-移动端订阅链接"},null,8,["modelValue"]),t(s,{modelValue:o(l).save_path_id,"onUpdate:modelValue":e[11]||(e[11]=a=>o(l).save_path_id=a),name:"save_path_id",label:"保存目录ID",placeholder:"保存目录ID",rules:[{required:!0,message:"请选择保存目录ID"}],"right-icon":"search",onClickRightIcon:e[12]||(e[12]=a=>V.value=!0)},null,8,["modelValue"]),t(s,{name:"status",label:"任务状态",rules:[{required:!0,message:"请选择任务状态"}]},{input:n(()=>[t(q,{modelValue:o(l).status,"onUpdate:modelValue":e[13]||(e[13]=a=>o(l).status=a),direction:"horizontal"},{default:n(()=>[t(i,{name:1},{default:n(()=>e[21]||(e[21]=[p("执行")])),_:1}),t(i,{name:0},{default:n(()=>e[22]||(e[22]=[p("暂停")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{name:"save_type",label:"保存模式",rules:[{required:!0,message:"请选择保存模式"}]},{input:n(()=>[t(q,{modelValue:o(l).save_type,"onUpdate:modelValue":e[14]||(e[14]=a=>o(l).save_type=a),direction:"horizontal"},{default:n(()=>[t(i,{name:0},{default:n(()=>e[23]||(e[23]=[p("仅文件")])),_:1}),t(i,{name:1},{default:n(()=>e[24]||(e[24]=[p("文件和文件夹")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{modelValue:o(l).episode_total,"onUpdate:modelValue":e[15]||(e[15]=a=>o(l).episode_total=a),name:"episode_total",label:"总集数",placeholder:"总集数"},null,8,["modelValue"]),t(s,{modelValue:o(l).episode,"onUpdate:modelValue":e[16]||(e[16]=a=>o(l).episode=a),name:"episode",label:"已更集数",placeholder:"已更集数"},null,8,["modelValue"])]),_:1}),j("div",O,[t(B,{round:"",block:"",type:"primary","native-type":"submit",loading:_.value},{default:n(()=>e[25]||(e[25]=[p(" 提交 ")])),_:1},8,["loading"])])]),_:1}),f.value?(U(),C(E,{key:0,modelValue:f.value,"onUpdate:modelValue":e[17]||(e[17]=a=>f.value=a),fileId:o(l).share_file_id,shareCode:o(l).share_code,onSelect:e[18]||(e[18]=a=>o(l).share_file_id=a)},null,8,["modelValue","fileId","shareCode"])):S("",!0),V.value?(U(),C(L,{key:1,modelValue:V.value,"onUpdate:modelValue":e[19]||(e[19]=a=>V.value=a),onSelect:e[20]||(e[20]=a=>o(l).save_path_id=a),id:o(l).save_path_id,name:o(l).task_name},null,8,["modelValue","id","name"])):S("",!0)])}}};export{Q as default};
