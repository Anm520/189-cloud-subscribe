import{z as V,B as me,C as R,D as ye,E as ge,G as be,c as W,o as ae,H as he,u as L,I as _e,_ as ke,r as k,J as we,a as j,e as r,b as $,w as g,f as b,K as N,F as Y,v as Z,L as ee,A as M,M as te,y as F,k as I,x as z,N as ne,O as oe}from"./index-idOx3MXX.js";function se(t){return ge()?(be(t),!0):!1}const G=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ce=Object.prototype.toString,xe=t=>Ce.call(t)==="[object Object]";function Fe(t){let o;function u(){return o||(o=t()),o}return u.reset=async()=>{const d=o;o=void 0,d&&await d},u}function D(t){return Array.isArray(t)?t:[t]}function Ie(t,o,u={}){const{immediate:d=!0,immediateCallback:m=!1}=u,p=V(!1);let y=null;function l(){y&&(clearTimeout(y),y=null)}function a(){p.value=!1,l()}function f(...i){m&&t(),l(),p.value=!0,y=setTimeout(()=>{p.value=!1,y=null,t(...i)},R(o))}return d&&(p.value=!0,G&&f()),se(a),{isPending:me(p),start:f,stop:a}}function Le(t,o,u){return ye(t,o,{...u,immediate:!0})}const Se=G?window:void 0,ie=G?window.navigator:void 0;function Te(t){var o;const u=R(t);return(o=u==null?void 0:u.$el)!=null?o:u}function re(...t){const o=[],u=()=>{o.forEach(l=>l()),o.length=0},d=(l,a,f,i)=>(l.addEventListener(a,f,i),()=>l.removeEventListener(a,f,i)),m=W(()=>{const l=D(R(t[0])).filter(a=>a!=null);return l.every(a=>typeof a!="string")?l:void 0}),p=Le(()=>{var l,a;return[(a=(l=m.value)==null?void 0:l.map(f=>Te(f)))!=null?a:[Se].filter(f=>f!=null),D(R(m.value?t[1]:t[0])),D(L(m.value?t[2]:t[1])),R(m.value?t[3]:t[2])]},([l,a,f,i])=>{if(u(),!(l!=null&&l.length)||!(a!=null&&a.length)||!(f!=null&&f.length))return;const w=xe(i)?{...i}:i;o.push(...l.flatMap(h=>a.flatMap(_=>f.map(E=>d(h,_,E,w)))))},{flush:"post"}),y=()=>{p(),u()};return se(u),y}function Ne(){const t=V(!1),o=he();return o&&ae(()=>{t.value=!0},o),t}function ue(t){const o=Ne();return W(()=>(o.value,!!t()))}function le(t,o={}){const{controls:u=!1,navigator:d=ie}=o,m=ue(()=>d&&"permissions"in d),p=V(),y=typeof t=="string"?{name:t}:t,l=V(),a=()=>{var i,w;l.value=(w=(i=p.value)==null?void 0:i.state)!=null?w:"prompt"};re(p,"change",a,{passive:!0});const f=Fe(async()=>{if(m.value){if(!p.value)try{p.value=await d.permissions.query(y)}catch{p.value=void 0}finally{a()}if(u)return _e(p.value)}});return f(),u?{state:l,isSupported:m,query:f}:l}function Re(t={}){const{navigator:o=ie,read:u=!1,source:d,copiedDuring:m=1500,legacy:p=!1}=t,y=ue(()=>o&&"clipboard"in o),l=le("clipboard-read"),a=le("clipboard-write"),f=W(()=>y.value||p),i=V(""),w=V(!1),h=Ie(()=>w.value=!1,m,{immediate:!1});function _(){let c=!(y.value&&P(l.value));if(!c)try{o.clipboard.readText().then(v=>{i.value=v})}catch{c=!0}c&&(i.value=U())}f.value&&u&&re(["copy","cut"],_,{passive:!0});async function E(c=R(d)){if(f.value&&c!=null){let v=!(y.value&&P(a.value));if(!v)try{await o.clipboard.writeText(c)}catch{v=!0}v&&A(c),i.value=c,w.value=!0,h.start()}}function A(c){const v=document.createElement("textarea");v.value=c??"",v.style.position="absolute",v.style.opacity="0",document.body.appendChild(v),v.select(),document.execCommand("copy"),v.remove()}function U(){var c,v,S;return(S=(v=(c=document==null?void 0:document.getSelection)==null?void 0:c.call(document))==null?void 0:v.toString())!=null?S:""}function P(c){return c==="granted"||c==="prompt"}return{isSupported:f,text:i,copied:w,copy:E}}const Ve={style:{border:"1px solid #ccc"}},Ee={style:{border:"1px solid #ccc"}},Ae={__name:"index",setup(t){const o=k(null),u=k(null);let d=k(!1);const m=k("-11"),p=k({id:-11,name:"根目录",parentId:-11}),y=we({}),l=k({count:0,fileList:[],fileListSize:0,folderList:[]}),a=k([]),f=s=>{m.value=s.id,p.value=s,y[s.id]=s,a.value=[],i(),o.value.scrollTo({top:0,behavior:"smooth"}),u.value.scrollTo({top:0,behavior:"smooth"})},i=()=>{const s={pageSize:1e3,pageNum:1,mediaType:"0",folderId:String(m.value),iconOption:"5",orderBy:"filename",descending:!1},e=ee({message:"加载中...",forbidClick:!0,duration:0});M.getListFiles(s).then(C=>{l.value=C.fileListAO}).finally(()=>{te(e)})},w=s=>{s.id!=-11&&(m.value=s.parentId,s.parentId==-11?p.value={id:-11,name:"根目录",parentId:-11}:p.value=y[s.parentId],i(),o.value.scrollTo({top:0,behavior:"smooth"}),u.value.scrollTo({top:0,behavior:"smooth"}))};let h=k(!1),_=k("");const E=s=>new Promise((e,C)=>{if(s=="confirm"){if(_.value=="")return F({type:"warning",message:"请输入文件夹名称",duration:1e3}),e(!1);const T={folderName:_.value,parentFolderId:m.value};M.createFolder(T).then(x=>{_.value="",i(),d.value=!1,e(!0),F({type:"success",message:"创建成功",duration:1e3})}).catch(()=>{e(!1)})}else e(!0)}),A=s=>{let e="";s?e=[{fileId:s.id,fileName:s.name,isFolder:s.fileCata}]:e=a.value.map(x=>({fileId:x.id,fileName:x.name,isFolder:x.fileCata}));const C={type:"DELETE",taskInfos:JSON.stringify(e),targetFolderId:""},T=ee({message:"删除中...",forbidClick:!0,duration:0});M.createBatchTask(C).then(x=>{d.value=!1,F({type:"success",message:"删除成功",duration:1e3}),i()}).finally(()=>{te(T)})},{copy:U}=Re({legacy:!0}),P=()=>{U(m.value).then(()=>{F({type:"success",message:"复制成功",duration:1e3})}).catch(s=>{F({type:"error",message:"复制失败",duration:1e3})})};let c=k(!1),v=k({destFolderName:"",folderId:""});const S=s=>{v.value={destFolderName:s.name,folderId:s.id},c.value=!0},ce=s=>new Promise((e,C)=>{if(s=="confirm"){if(v.value.destFolderName=="")return F({type:"warning",message:"请输入文件名称",duration:1e3}),e(!1);M.renameFolder(v.value).then(T=>{F({type:"success",message:"重命名成功",duration:1e3}),i(),e(!0)}).catch(()=>{e(!1)})}else e(!0)});return ae(()=>{i()}),(s,e)=>{const C=b("van-icon"),T=b("van-nav-bar"),x=b("van-sticky"),O=b("van-cell"),J=b("van-cell-group"),de=b("van-popup"),H=b("van-checkbox"),q=b("van-button"),K=b("van-swipe-cell"),pe=b("van-checkbox-group"),Q=b("van-field"),X=b("van-dialog"),fe=b("van-back-top");return I(),j("div",{ref_key:"boxRef",ref:o},[r(x,null,{default:g(()=>[r(T,{title:p.value.name,"left-arrow":"",onClickLeft:e[1]||(e[1]=n=>w(p.value))},{right:g(()=>[r(C,{name:"bars",size:"18",onClick:e[0]||(e[0]=n=>N(d)?d.value=!0:d=!0)})]),_:1},8,["title"])]),_:1}),r(de,{show:L(d),"onUpdate:show":e[4]||(e[4]=n=>N(d)?d.value=n:d=n),position:"right",style:{width:"50%",height:"100%"}},{default:g(()=>[r(J,null,{default:g(()=>[r(O,{title:"新建文件夹","is-link":"",onClick:e[2]||(e[2]=n=>N(h)?h.value=!0:h=!0),icon:"plus"}),r(O,{title:"批量删除","is-link":"",icon:"delete-o",onClick:e[3]||(e[3]=n=>A(null))}),r(O,{title:"复制当前目录ID","is-link":"",icon:"arrow-right",onClick:P})]),_:1})]),_:1},8,["show"]),$("div",{ref_key:"checkboxRef",ref:u,id:"checkbox"},[r(pe,{modelValue:a.value,"onUpdate:modelValue":e[7]||(e[7]=n=>a.value=n)},{default:g(()=>[r(J,null,{default:g(()=>[(I(!0),j(Y,null,Z(l.value.folderList,(n,ve)=>(I(),z(K,{clickable:"",key:n.id},{right:g(()=>[r(q,{square:"",type:"danger",text:"删除",onClick:B=>A(n)},null,8,["onClick"]),r(q,{square:"",type:"primary",text:"重命名",onClick:B=>S(n)},null,8,["onClick"])]),default:g(()=>[r(O,{title:n.name,"title-class":"van-ellipsis",onClick:B=>f(n)},{icon:g(()=>[r(C,{name:"card",color:"#fabb68",size:"20px",style:{"margin-right":"5px"}})]),"right-icon":g(()=>[r(H,{name:n,onClick:e[5]||(e[5]=ne(()=>{},["stop"]))},null,8,["name"])]),_:2},1032,["title","onClick"])]),_:2},1024))),128)),(I(!0),j(Y,null,Z(l.value.fileList,(n,ve)=>(I(),z(K,{clickable:"",key:n.id},{right:g(()=>[r(q,{square:"",type:"danger",text:"删除",onClick:B=>A(n)},null,8,["onClick"]),r(q,{square:"",type:"primary",text:"重命名",onClick:B=>S(n)},null,8,["onClick"])]),default:g(()=>[r(O,{title:n.name,"title-class":"van-ellipsis"},{icon:g(()=>[n.mediaType==1?(I(),z(C,{key:0,name:"photo-o",color:"#fabb68",size:"20px",style:{"margin-right":"5px"}})):oe("",!0),n.mediaType==3?(I(),z(C,{key:1,name:"video",color:"#fabb68",size:"20px",style:{"margin-right":"5px"}})):oe("",!0)]),"right-icon":g(()=>[r(H,{name:n,onClick:e[6]||(e[6]=ne(()=>{},["stop"]))},null,8,["name"])]),_:2},1032,["title"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),r(X,{show:L(h),"onUpdate:show":e[9]||(e[9]=n=>N(h)?h.value=n:h=n),title:"新建文件夹","show-cancel-button":"","before-close":E},{default:g(()=>[$("div",Ve,[r(Q,{modelValue:L(_),"onUpdate:modelValue":e[8]||(e[8]=n=>N(_)?_.value=n:_=n),label:"",placeholder:"输入文件夹名",required:"",autofocus:"",clearable:""},null,8,["modelValue"])])]),_:1},8,["show"]),r(X,{show:L(c),"onUpdate:show":e[11]||(e[11]=n=>N(c)?c.value=n:c=n),title:"重命名","show-cancel-button":"","before-close":ce},{default:g(()=>[$("div",Ee,[r(Q,{modelValue:L(v).destFolderName,"onUpdate:modelValue":e[10]||(e[10]=n=>L(v).destFolderName=n),label:"",placeholder:"输入文件名",required:"",clearable:""},null,8,["modelValue"])])]),_:1},8,["show"]),r(fe)],512)],512)}}},Pe=ke(Ae,[["__scopeId","data-v-429fd919"]]);export{Pe as default};
