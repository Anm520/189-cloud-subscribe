import{_ as Y,r as s,o as Z,a as l,e as r,w as d,f as i,u as ee,i as ae,b as n,F as S,q as I,v as $,N as y,x as b,Q as A,A as te,P as oe,j as o,t as c,h as B}from"./index-CUGguU5z.js";import se from"./OneClickSave-D0dXfrbQ.js";import le from"./CreateTask-Dy0Pewnt.js";import{u as ne}from"./config-C9uNFu5H.js";import"./FloderSelect-Doz3Bnf9.js";import"./hooks-B8RcsGp2.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ue={class:"poster-wall"},re=["onClick"],ie={key:0,class:"poster-image"},ce=["alt","src"],ve={class:"poster-info"},de={class:"poster-title"},_e={class:"poster-subtitle"},he={key:1,class:"poster-title"},pe={class:"poster-meta"},fe={class:"time"},ge={key:0,class:"tags"},me={class:"views"},ke={class:"author"},we={key:1,class:"size"},ye={class:"download-links"},Ce={__name:"index",setup(xe){const L=ne(),R=ae(),h=s(L.chanel_url),u=s([]),f=s(!1),g=s(!1),_=s(!1),v=s(!1),m=s(!1),U=async()=>{if(!h.value){te.getConfig().then(a=>{a[0].chanel_url?(h.value=a[0].chanel_url,L.setChangelUrl(a[0].chanel_url),U()):b({type:"danger",message:"请先去【定时配置】页面配频道地址",duration:1e3})});return}if(p.value){m.value=!0;return}else m.value=!1;let t="";u.value.length>0?t=`${h.value}/messages?before=${u.value[u.value.length-1].id}`:t=`${h.value}/messages`,A.get(t).then(a=>{console.log("res>>>>",a.data.data),u.value=[...u.value,...a.data.data.reverse()],_.value=!1,v.value=!1}).catch(()=>{_.value=!1,v.value=!1,m.value=!0})},q=()=>{console.log("下拉刷新 >>>>>:"),v.value=!0,u.value=[],U()},k=s(""),D=t=>{console.log("点击了:",t.text)},C=s(!1),F=[{name:"查看链接",icon:"link-o"},{name:"添加订阅",icon:"edit"},{name:"一键转存",icon:"edit"}],P=t=>{if(t.name=="查看链接"){oe(()=>{k.value&&window.open(k.value)});return}t.name==="添加订阅"&&(g.value=!0),t.name==="一键转存"&&(f.value=!0),C.value=!1},T=t=>{console.log("onClickLink >>>>>:",t),k.value=t,C.value=!0},x=s(window.localStorage.getItem("showImage")!=="0"),j=()=>{x.value?(x.value=!1,localStorage.setItem("showImage","0"),b({type:"primary",duration:1e3,message:"已开启无图模式"})):(x.value=!0,localStorage.setItem("showImage","1"),b({type:"primary",duration:1e3,message:"已开启有图模式"}))},p=s(""),N=()=>{if(console.log("value >>>>>:",p.value),!h.value){b({type:"danger",message:"请先去【定时配置】页面配频道地址",duration:1e3});return}p.value&&(u.value=[],_.value=!0,v.value=!0,A.get(`${h.value}/search?q=${p.value}`).then(t=>{console.log("res>>>>",t.data.data),u.value=t.data.data.reverse()||[],_.value=!1,v.value=!1}).catch(()=>{u.value=[],_.value=!1,v.value=!1,m.value=!0,console.log("error失败")}))};return Z(()=>{}),(t,a)=>{const E=i("van-icon"),M=i("van-nav-bar"),Q=i("van-search"),G=i("van-sticky"),H=i("van-button"),J=i("van-action-sheet"),K=i("van-list"),O=i("van-pull-refresh"),z=i("van-popup"),W=i("van-back-top");return o(),l("div",null,[r(G,null,{default:d(()=>[r(M,{"left-arrow":"",title:"频道消息",onClickLeft:a[0]||(a[0]=e=>ee(R).back())},{right:d(()=>[r(E,{name:"photo-o",size:"18",onClick:j})]),_:1}),r(Q,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),"show-action":"",placeholder:"请输入搜索关键词",onSearch:N},{action:d(()=>[n("div",{onClick:N},"搜索")]),_:1},8,["modelValue"])]),_:1}),r(O,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=e=>v.value=e),onRefresh:q},{default:d(()=>[r(K,{loading:_.value,"onUpdate:loading":a[3]||(a[3]=e=>_.value=e),"finished-text":"没有更多了,如果网络不好，请点击右上角开启无图模式！",onLoad:U,finished:m.value},{default:d(()=>[n("div",ue,[(o(!0),l(S,null,I(u.value,(e,X)=>(o(),l("div",{key:X,class:"poster-item",onClick:w=>D(e)},[e.image_url&&x.value?(o(),l("div",ie,[n("img",{alt:e.text,src:e.image_url},null,8,ce)])):y("",!0),n("div",ve,[e.title?(o(),l(S,{key:0},[n("h3",de,c(e.title),1),n("div",_e,c(e.text),1)],64)):(o(),l("h3",he,c(e.text),1)),n("div",pe,[n("div",fe," 时间: "+c(new Date(e.time).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})),1),e.tags.length?(o(),l("div",ge,[a[9]||(a[9]=B(" 标签: ")),(o(!0),l(S,null,I(e.tags,(w,V)=>(o(),l("span",{key:V,class:"tag"},c(w),1))),128))])):y("",!0),n("span",me,"观看: "+c(e.views),1),n("span",ke,"作者: "+c(e.author),1),e.size?(o(),l("span",we,"大小: "+c(e.size),1)):y("",!0)]),n("div",ye,[(o(!0),l(S,null,I(e.download_links,(w,V)=>(o(),$(H,{key:V,size:"small",type:"primary",onClick:Se=>T(w.url)},{default:d(()=>[B(c(w.type),1)]),_:2},1032,["onClick"]))),128))])])],8,re))),128)),r(J,{show:C.value,"onUpdate:show":a[2]||(a[2]=e=>C.value=e),actions:F,title:"操作",onSelect:P},null,8,["show"])])]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"]),r(z,{show:f.value,"onUpdate:show":a[6]||(a[6]=e=>f.value=e),position:"bottom",style:{height:"90%"}},{default:d(()=>[f.value?(o(),$(se,{key:0,shareUrl:k.value,onClose:a[5]||(a[5]=()=>f.value=!1)},null,8,["shareUrl"])):y("",!0)]),_:1},8,["show"]),r(z,{show:g.value,"onUpdate:show":a[8]||(a[8]=e=>g.value=e),position:"bottom",style:{height:"90%"}},{default:d(()=>[g.value?(o(),$(le,{key:0,shareUrl:k.value,onClose:a[7]||(a[7]=()=>g.value=!1)},null,8,["shareUrl"])):y("",!0)]),_:1},8,["show"]),r(W)])}}},ze=Y(Ce,[["__scopeId","data-v-0a38d9ee"]]);export{ze as default};
