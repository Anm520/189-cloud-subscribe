import{l as w,m as U,n as V,p as $,e as a,q,s as F,r as p,c as R,o as j,a as x,w as d,f as s,u as S,j as E,F as W,v as z,A as g,k as _,x as H,h as M,y as I}from"./index-idOx3MXX.js";let h;const G={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let J=w({},G);function K(){({instance:h}=V({setup(){const{state:o,toggle:r}=$();return()=>a(F,q(o,{"onUpdate:show":r}),null)}}))}function Q(u){return U?new Promise((o,r)=>{h||K(),h.open(w({},J,u,{callback:c=>{(c==="confirm"?o:r)(c)}}))}):Promise.resolve(void 0)}const X=u=>Q(w({showCancelButton:!0},u)),Z={__name:"AccountList",setup(u){const o=E(),r=()=>o.back(),c=p([]),f=p(!1),v=p(!1),i=p(window.localStorage.getItem("account")),L=R(()=>{let e="没有更多了，左滑删除账号";return c.value.length==0&&(e="请点击右上角添加云盘账号"),i.value==""&&(e="请点击账号选中为当前账号！右上角添加云盘账号"),e}),m=()=>{f.value=!0,g.getAccountList().then(e=>{c.value=e}).finally(()=>{f.value=!1,v.value=!1})},P=()=>{v.value=!0,m()},A=e=>{X({title:"提醒",message:"是否删除该云盘账号？",beforeClose:n=>new Promise((l,C)=>{if(n==="cancel")return l(!0);g.BatchDelete({list:[e]}).then(()=>(I({type:"success",message:"删除成功",duration:1e3}),i.value==e&&(i.value="",window.localStorage.setItem("account",""),window.sessionStorage.setItem("cloud","")),m(),l(!0))).catch(y=>l(!1))})})},k=(e,n)=>{g.cloudLogin({account:e}).then(l=>{window.sessionStorage.setItem("cloud",l.cookies||""),window.localStorage.setItem("account",l.account),i.value=e,I({type:"success",message:"登陆成功",duration:1e3}),o.push("/home/user")})},D=e=>{if(!e.cookies){k(e.account);return}window.sessionStorage.setItem("cloud",e.cookies||""),window.localStorage.setItem("account",e.account),o.push("/home/user")};return j(()=>{m()}),(e,n)=>{const l=s("van-icon"),C=s("van-nav-bar"),y=s("van-cell"),B=s("van-button"),O=s("van-swipe-cell"),T=s("van-list"),N=s("van-pull-refresh");return _(),x("div",null,[a(C,{title:"云盘账号","left-arrow":"",onClickLeft:r},{right:d(()=>[a(l,{name:"plus",size:"18",onClick:n[0]||(n[0]=t=>S(o).push("/home/addacc"))})]),_:1}),a(N,{modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=t=>v.value=t),onRefresh:P},{default:d(()=>[a(T,{loading:f.value,"onUpdate:loading":n[1]||(n[1]=t=>f.value=t),"finished-text":L.value,onLoad:m,finished:!0},{default:d(()=>[(_(!0),x(W,null,z(c.value,t=>(_(),H(O,{key:t.account},{right:d(()=>[a(B,{square:"",type:"danger",text:"删除",onClick:b=>A(t.account)},null,8,["onClick"]),a(B,{square:"",type:"primary",text:"登陆",onClick:b=>k(t.account,"back")},null,8,["onClick"])]),default:d(()=>[a(y,{title:S(M)(t.account),value:"",onClick:b=>D(t),icon:i.value==t.account?"success":""},null,8,["title","onClick","icon"])]),_:2},1024))),128))]),_:1},8,["loading","finished-text"])]),_:1},8,["modelValue"])])}}};export{Z as default};
