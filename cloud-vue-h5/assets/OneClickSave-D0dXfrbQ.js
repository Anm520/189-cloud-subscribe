import{r as p,o as B,a as F,e as s,v as I,N as b,w as v,f as n,b as $,u as o,h as A,R as E,i as T,x as C,A as S,j as k}from"./index-CUGguU5z.js";import{_ as L,F as M}from"./FloderSelect-Doz3Bnf9.js";import"./hooks-B8RcsGp2.js";import"./_commonjsHelpers-Cpj98o6Y.js";const O={style:{margin:"16px"}},z={__name:"OneClickSave",props:{shareUrl:{type:String,default:""}},emits:["close"],setup(U,{emit:q}){const D=T(),t=E(),d=p(!1),i=U,y=q;let a=p({share_url:"",share_code:"",task_name:"",share_id:"",share_file_id:"",save_path_id:"",status:1,share_mode:3,save_type:0,episode_total:0,episode:0});const h=f=>{let e="";if(f?(e=a.value.share_url&&a.value.share_url.match(/\/t\/([^\/]+)/)&&a.value.share_url.match(/\/t\/([^\/]+)/)[1]||"",a.value.share_code=e):e=a.value.share_code,console.log("shareCode",e),!e)return C({type:"warning",message:"请输入分享链接或分享码",duration:1e3});S.getShareInfoByCode({shareCode:e}).then(u=>{console.log("getShareInfoByCode >>>>>:",u);const{shareMode:c,shareId:r,fileId:g,fileName:V}=u;a.value.share_id=String(r),a.value.share_mode=c,a.value.share_file_id=g,a.value.task_name=V})},m=p(!1),_=p(!1),N=f=>{console.log("values >>>>>:",a.value),d.value=!0;const e={type:"SHARE_SAVE",taskInfos:JSON.stringify([{fileId:a.value.share_file_id,fileName:a.value.task_name,isFolder:1}]),targetFolderId:a.value.save_path_id,shareId:a.value.share_id};S.createBatchTask(e).then(u=>{d.value=!1,C({type:"success",message:"转存成功",duration:1e3}),y("close")}).finally(()=>{d.value=!1})},R=()=>{(t.query&&t.query.url||i.shareUrl)&&(console.log("url",t.query.url,i.shareUrl),a.value.share_url=t.query.url||i.shareUrl,h(!0))},w=()=>{t.query&&t.query.url?D.back():y("close")};return B(()=>{console.log("props >>>>>:",i.shareUrl),R()}),(f,e)=>{const u=n("van-nav-bar"),c=n("van-sticky"),r=n("van-field"),g=n("van-cell-group"),V=n("van-button"),x=n("van-form");return k(),F("div",null,[s(c,null,{default:v(()=>[s(u,{title:"一键转存","left-arrow":"",onClickLeft:w})]),_:1}),s(x,{onSubmit:N,style:{"margin-top":"10px"},required:"auto"},{default:v(()=>[s(g,{inset:""},{default:v(()=>[s(r,{modelValue:o(a).share_url,"onUpdate:modelValue":e[0]||(e[0]=l=>o(a).share_url=l),name:"share_url",label:"分享链接",placeholder:"分享链接","right-icon":"search",onClickRightIcon:e[1]||(e[1]=l=>h(!0))},null,8,["modelValue"]),s(r,{modelValue:o(a).share_code,"onUpdate:modelValue":e[2]||(e[2]=l=>o(a).share_code=l),name:"share_code",label:"share_code",placeholder:"share_code",rules:[{required:!0,message:"请填写share_code"}],"right-icon":"search",onClickRightIcon:e[3]||(e[3]=l=>h(!1))},null,8,["modelValue"]),s(r,{modelValue:o(a).task_name,"onUpdate:modelValue":e[4]||(e[4]=l=>o(a).task_name=l),name:"task_name",label:"分享目录",placeholder:"分享目录"},null,8,["modelValue"]),s(r,{modelValue:o(a).share_id,"onUpdate:modelValue":e[5]||(e[5]=l=>o(a).share_id=l),name:"share_id",label:"分享ID",placeholder:"分享ID",rules:[{required:!0,message:"请填写分享ID"}]},null,8,["modelValue"]),s(r,{modelValue:o(a).share_file_id,"onUpdate:modelValue":e[6]||(e[6]=l=>o(a).share_file_id=l),name:"share_file_id",label:"分享目录ID",placeholder:"分享目录ID",rules:[{required:!0,message:"请填写分享目录ID"}],"right-icon":"search",onClickRightIcon:e[7]||(e[7]=l=>m.value=!0)},null,8,["modelValue"]),s(r,{modelValue:o(a).share_mode,"onUpdate:modelValue":e[8]||(e[8]=l=>o(a).share_mode=l),name:"share_mode",label:"分享模式",placeholder:"3-pc,5-移动端订阅链接"},null,8,["modelValue"]),s(r,{modelValue:o(a).save_path_id,"onUpdate:modelValue":e[9]||(e[9]=l=>o(a).save_path_id=l),name:"save_path_id",label:"保存目录ID",placeholder:"保存目录ID",rules:[{required:!0,message:"请选择保存目录ID"}],"right-icon":"search",onClickRightIcon:e[10]||(e[10]=l=>_.value=!0)},null,8,["modelValue"])]),_:1}),$("div",O,[s(V,{round:"",block:"",type:"primary","native-type":"submit",loading:d.value},{default:v(()=>e[15]||(e[15]=[A(" 转存 ")])),_:1},8,["loading"])])]),_:1}),m.value?(k(),I(L,{key:0,modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=l=>m.value=l),fileId:o(a).share_file_id,shareCode:o(a).share_code,onSelect:e[12]||(e[12]=l=>o(a).share_file_id=l)},null,8,["modelValue","fileId","shareCode"])):b("",!0),_.value?(k(),I(M,{key:1,modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=l=>_.value=l),onSelect:e[14]||(e[14]=l=>o(a).save_path_id=l),id:o(a).save_path_id,name:o(a).task_name},null,8,["modelValue","id","name"])):b("",!0)])}}};export{z as default};
