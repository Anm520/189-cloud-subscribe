import{S as L,r as _,D as O,f as d,a as T,k as x,e as t,w as n,F as $,v as J,N as P,Q as j,T as A,o as E,x as R,O as z,u as o,j as Q,b as W,i as v,A as C,y as N}from"./index-idOx3MXX.js";import{_ as G,F as H}from"./FloderSelect-DO53QD-i.js";import"./hooks-BZUA6U_w.js";import"./_commonjsHelpers-Cpj98o6Y.js";const K={__name:"WeekSelect",props:{modelValue:{default:"[8]"},modelModifiers:{}},emits:["update:modelValue"],setup(I){const V=L(I,"modelValue"),f=_(""),g=_(!1),k=[{text:"每日",value:8},{text:"周一",value:1},{text:"周二",value:2},{text:"周三",value:3},{text:"周四",value:4},{text:"周五",value:5},{text:"周六",value:6},{text:"周日",value:7}],u=_([]);O(()=>V.value,l=>{if(console.log("newValue >>>>>:",l),l)try{u.value=JSON.parse(l)}catch{u.value=[]}else u.value=[];f.value=k.filter(r=>u.value.includes(r.value)).map(r=>r.text).join("、"),console.log("showValue.value >>>>>:",f.value)},{deep:!0,immediate:!0});const q=()=>{console.log("checked.value >>>>>:",JSON.stringify(u.value)),u.value.length>0?V.value=JSON.stringify(u.value):V.value="",j(()=>{console.log("value.value >>>>>:",V.value),g.value=!1})},y=()=>{g.value=!1};return(l,r)=>{const h=d("van-field"),b=d("van-nav-bar"),S=d("van-checkbox"),D=d("van-cell"),i=d("van-cell-group"),e=d("van-checkbox-group"),c=d("van-popup");return x(),T($,null,[t(h,{"model-value":f.value,readonly:"",name:"show_task_week",label:"执行时间",placeholder:"点击选择时间",onClick:r[0]||(r[0]=m=>{g.value=!0}),rules:[{required:!0,message:"请填写执行时间"}]},null,8,["model-value"]),t(c,{show:g.value,position:"bottom",style:{height:"60%"}},{default:n(()=>[t(b,{title:"选择时间","left-text":"取消",onClickLeft:y,"right-text":"确认",onClickRight:q}),t(e,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=m=>u.value=m)},{default:n(()=>[t(i,{inset:""},{default:n(()=>[(x(),T($,null,J(k,(m,U)=>t(D,{clickable:"",key:m,title:m.text},{"right-icon":n(()=>[t(S,{name:m.value,onClick:r[1]||(r[1]=P(()=>{},["stop"]))},null,8,["name"])]),_:2},1032,["title"])),64))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["show"])],64)}}},X={style:{margin:"16px"}},ae={__name:"CreateTask",props:{shareUrl:{type:String,default:""}},emits:["close"],setup(I,{emit:V}){const f=I,g=V,k=Q(),u=A();_(!1);const q=_(u.query.id?"编辑任务":"创建任务"),y=_(!1);let l=_({episode_filter_num:0,episode_filter_type:1,filter_text:"",filter_text_type:1,share_url:"",share_code:"",task_name:"",share_id:"",share_file_id:"",save_path_id:"",status:1,share_mode:3,save_type:0,episode_total:0,episode:0,task_week:"[8]"});const r=i=>{let e="";if(i?(e=l.value.share_url&&l.value.share_url.match(/\/t\/([^\/]+)/)[1]||"",l.value.share_code=e):e=l.value.share_code,console.log("shareCode",e),!e)return N({type:"warning",message:"请输入分享链接或分享码",duration:1e3});C.getShareInfoByCode({shareCode:e}).then(c=>{const{shareMode:m,shareId:U,fileId:s,fileName:p}=c;l.value.share_id=String(U),l.value.share_mode=m,l.value.share_file_id=s,l.value.task_name=p})},h=_(!1),b=_(!1),S=i=>{y.value=!0,l.value.id?(console.log("updateTask >>>>>:",l.value),C.updateTask(l.value).then(e=>{N({type:"success",message:"保存成功",duration:1e3}),k.back()}).finally(()=>{y.value=!1})):C.createTask({...l.value,account:i.account?i.account:window.localStorage.getItem("account")}).then(e=>{N({type:"success",message:"创建成功",duration:1e3}),f.shareUrl?g("close"):k.back()}).finally(()=>{y.value=!1})},D=()=>{u.query&&u.query.id&&C.getTaskDetail({id:u.query.id}).then(i=>{l.value={...i}}),u.query&&u.query.url&&(console.log("123",u.query.url),l.value.share_url=u.query.url,r(!0)),f.shareUrl&&(l.value.share_url=f.shareUrl,r(!0))};return E(()=>{D()}),(i,e)=>{const c=d("van-icon"),m=d("van-nav-bar"),U=d("van-sticky"),s=d("van-field"),p=d("van-radio"),w=d("van-radio-group"),B=d("van-cell-group"),F=d("van-button"),M=d("van-form");return x(),T("div",null,[t(U,null,{default:n(()=>[t(m,{title:q.value,"left-arrow":"",onClickLeft:e[1]||(e[1]=a=>o(k).back())},{right:n(()=>[t(c,{name:"bars",size:"18",onClick:e[0]||(e[0]=a=>i.showRight=!0)})]),_:1},8,["title"])]),_:1}),t(M,{onSubmit:S,style:{"margin-top":"10px"},required:"auto"},{default:n(()=>[t(B,{inset:""},{default:n(()=>[t(s,{modelValue:o(l).share_url,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).share_url=a),name:"share_url",label:"分享链接",placeholder:"分享链接","right-icon":"search",onClickRightIcon:e[3]||(e[3]=a=>r(!0))},null,8,["modelValue"]),t(s,{modelValue:o(l).share_code,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).share_code=a),name:"share_code",label:"share_code",placeholder:"share_code",rules:[{required:!0,message:"请填写share_code"}],"right-icon":"search",onClickRightIcon:e[5]||(e[5]=a=>r(!1))},null,8,["modelValue"]),t(s,{modelValue:o(l).task_name,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).task_name=a),name:"task_name",label:"任务名称",placeholder:"任务名称"},null,8,["modelValue"]),t(s,{modelValue:o(l).share_id,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).share_id=a),name:"share_id",label:"分享ID",placeholder:"分享ID",rules:[{required:!0,message:"请填写分享ID"}]},null,8,["modelValue"]),t(s,{modelValue:o(l).share_file_id,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).share_file_id=a),name:"share_file_id",label:"分享目录ID",placeholder:"分享目录ID",rules:[{required:!0,message:"请填写分享目录ID"}],"right-icon":"search",onClickRightIcon:e[9]||(e[9]=a=>h.value=!0)},null,8,["modelValue"]),t(s,{modelValue:o(l).share_mode,"onUpdate:modelValue":e[10]||(e[10]=a=>o(l).share_mode=a),name:"share_mode",label:"分享模式",placeholder:"3-pc,5-移动端订阅链接"},null,8,["modelValue"]),t(s,{modelValue:o(l).save_path_id,"onUpdate:modelValue":e[11]||(e[11]=a=>o(l).save_path_id=a),name:"save_path_id",label:"保存目录ID",placeholder:"保存目录ID",rules:[{required:!0,message:"请选择保存目录ID"}],"right-icon":"search",onClickRightIcon:e[12]||(e[12]=a=>b.value=!0)},null,8,["modelValue"]),t(K,{modelValue:o(l).task_week,"onUpdate:modelValue":e[13]||(e[13]=a=>o(l).task_week=a)},null,8,["modelValue"]),t(s,{modelValue:o(l).filter_text,"onUpdate:modelValue":e[14]||(e[14]=a=>o(l).filter_text=a),name:"filter_text",label:"筛选文本",placeholder:"筛选文本"},null,8,["modelValue"]),t(s,{name:"filter_text_type",label:"筛选方式"},{input:n(()=>[t(w,{modelValue:o(l).filter_text_type,"onUpdate:modelValue":e[15]||(e[15]=a=>o(l).filter_text_type=a),direction:"horizontal"},{default:n(()=>[t(p,{name:1},{default:n(()=>e[26]||(e[26]=[v("包含")])),_:1}),t(p,{name:2},{default:n(()=>e[27]||(e[27]=[v("不包含")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{modelValue:o(l).episode_filter_num,"onUpdate:modelValue":e[16]||(e[16]=a=>o(l).episode_filter_num=a),name:"episode_filter_num",label:"筛选集数",placeholder:"筛选符合集数保存下来"},null,8,["modelValue"]),t(s,{name:"episode_filter_type",label:"筛选集数方式"},{input:n(()=>[t(w,{modelValue:o(l).episode_filter_type,"onUpdate:modelValue":e[17]||(e[17]=a=>o(l).episode_filter_type=a),direction:"horizontal"},{default:n(()=>[t(p,{name:1},{default:n(()=>e[28]||(e[28]=[v("大于")])),_:1}),t(p,{name:2},{default:n(()=>e[29]||(e[29]=[v("小于")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{name:"status",label:"任务状态",rules:[{required:!0,message:"请选择任务状态"}]},{input:n(()=>[t(w,{modelValue:o(l).status,"onUpdate:modelValue":e[18]||(e[18]=a=>o(l).status=a),direction:"horizontal"},{default:n(()=>[t(p,{name:1},{default:n(()=>e[30]||(e[30]=[v("执行")])),_:1}),t(p,{name:0},{default:n(()=>e[31]||(e[31]=[v("暂停")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{name:"save_type",label:"保存模式",rules:[{required:!0,message:"请选择保存模式"}]},{input:n(()=>[t(w,{modelValue:o(l).save_type,"onUpdate:modelValue":e[19]||(e[19]=a=>o(l).save_type=a),direction:"horizontal"},{default:n(()=>[t(p,{name:0},{default:n(()=>e[32]||(e[32]=[v("仅文件")])),_:1}),t(p,{name:1},{default:n(()=>e[33]||(e[33]=[v("文件和文件夹")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{modelValue:o(l).episode_total,"onUpdate:modelValue":e[20]||(e[20]=a=>o(l).episode_total=a),name:"episode_total",label:"总集数",placeholder:"总集数"},null,8,["modelValue"]),t(s,{modelValue:o(l).episode,"onUpdate:modelValue":e[21]||(e[21]=a=>o(l).episode=a),name:"episode",label:"已更集数",placeholder:"已更集数"},null,8,["modelValue"])]),_:1}),W("div",X,[t(F,{round:"",block:"",type:"primary","native-type":"submit",loading:y.value},{default:n(()=>e[34]||(e[34]=[v(" 提交 ")])),_:1},8,["loading"])])]),_:1}),h.value?(x(),R(G,{key:0,modelValue:h.value,"onUpdate:modelValue":e[22]||(e[22]=a=>h.value=a),fileId:o(l).share_file_id,shareCode:o(l).share_code,onSelect:e[23]||(e[23]=a=>o(l).share_file_id=a)},null,8,["modelValue","fileId","shareCode"])):z("",!0),b.value?(x(),R(H,{key:1,modelValue:b.value,"onUpdate:modelValue":e[24]||(e[24]=a=>b.value=a),onSelect:e[25]||(e[25]=a=>o(l).save_path_id=a),id:o(l).save_path_id,name:o(l).task_name},null,8,["modelValue","id","name"])):z("",!0)])}}};export{ae as default};
