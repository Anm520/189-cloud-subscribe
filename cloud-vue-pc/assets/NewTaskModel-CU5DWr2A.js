import{m as J,r as i,u as W,q as X,A as N,b as m,d as C,o as p,e as t,c as a,j as O,k as z,l as Z,g as d,t as G,f as h,C as ee,x as s,B as le,a as P,w as ne,n as Q,h as q,y as ue,V as de,E as re}from"./index-BKinuvNY.js";import{a as ae}from"./index-e72A2cof.js";import{F as ie}from"./FolderTreeModel-D2cS3skF.js";import{u as fe}from"./CloudDisk-DhBrOmEO.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={key:0},pe={__name:"ShareFileIdSelectModal",props:J(["options"],{modelValue:{},modelModifiers:{}}),emits:J(["ok"],["update:modelValue"]),setup(f,{emit:E}){const x=i(""),R=i([]),g=i(null),T=i(null),F=ae(T,g),w=W(f,"modelValue"),V=i(!1),y=i(!1),D=E;X(()=>{console.log("options",f.options),y.value=!0;const I={noCache:Math.random(),...f.options,shareDirFileId:f.options.fileId,isFolder:!0,orderBy:"filename",descending:!1};N.getListShareDir(I).then(_=>{console.log("getListShareDir >>>>>:",_),R.value=_.fileListAO.folderList,V.value=_.fileListAO.folderList.length==0}).finally(()=>{y.value=!1})});const b=()=>{D("ok",x.value),w.value=!1};return(I,_)=>{const l=m("a-radio"),Y=m("a-radio-group"),U=m("a-spin"),j=m("a-modal");return p(),C(j,{open:w.value,"wrap-style":{overflow:"hidden"},onOk:b,onCancel:_[1]||(_[1]=k=>w.value=!1),class:"ant-modal-dray"},{title:t(()=>[h("div",{ref_key:"modalTitleRef",ref:g,class:"modal-title",style:{width:"100%",cursor:"move"}},"分享目录选择",512)]),modalRender:t(({originVNode:k})=>[h("div",{ref_key:"modalRef",ref:T,style:ee(s(F))},[(p(),C(le(k)))],4)]),default:t(()=>[a(U,{spinning:y.value},{default:t(()=>[V.value?(p(),O("div",ve,"该目录下无文件夹")):(p(),C(Y,{key:1,value:x.value,"onUpdate:value":_[0]||(_[0]=k=>x.value=k)},{default:t(()=>[(p(!0),O(z,null,Z(R.value,k=>(p(),O("div",{key:k.id},[a(l,{value:k.id},{default:t(()=>[d(G(k.name),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"]))]),_:1},8,["spinning"])]),_:1},8,["open"])}}},_e={class:"footer-btn"},ke={__name:"NewTaskModel",props:J({isAdd:Boolean,record:Object,url:String},{modelValue:{},modelModifiers:{}}),emits:J(["update"],["update:modelValue"]),setup(f,{emit:E}){const x=P([{label:"每日",value:8},{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}]),R=fe(),g=i(!1),T=n=>{l.save_path_id=n.id},F=i(null),w=i(null),V=ae(w,F),y=W(f,"modelValue"),D=E,b=i(!1),I=i(),_={labelCol:{span:5},wrapperCol:{span:13}};let l=P({episode_filter_num:0,episode_filter_type:1,filter_text:"",filter_text_type:1,task_name:"",status:1,share_id:"",share_file_id:"",access_code:"",description:"",save_path_id:"",share_mode:3,share_code:"",share_url:"",save_type:0,episode_total:0,episode:0,task_week:[8]});ne(()=>f.record,n=>{if(!f.isAdd){let e=[];try{e=JSON.parse(n.task_week)}catch(v){console.log("error >>>>>:",v)}l=P({...de(n),create_time:ue(n.create_time).format("YYYY-MM-DD HH:mm:ss"),update_time:"",task_week:e}),re(()=>{A.value={shareMode:n.share_mode,shareId:n.share_id,fileId:n.share_file_id,accessCode:n.access_code}})}},{deep:!0,immediate:!0});const Y={share_id:[{required:!0,message:"请输入分享ID",trigger:"blur"}],share_file_id:[{required:!0,message:"请输入分享目录ID",trigger:"blur"}],status:[{required:!0,message:"Please select activity resource",trigger:"change"}],save_type:[{required:!0,message:"请选择",trigger:"change"}]},U=i(!1),j=()=>{b.value=!0,I.value.validate().then(async()=>{f.isAdd?N.createTask({...l,account:R.CloudDiskUserInfo.account,task_week:JSON.stringify(l.task_week)}).then(n=>{q.success("保存成功"),y.value=!1,D("update")}).finally(()=>{b.value=!1}):N.updateTask({...l,task_week:JSON.stringify(l.task_week)}).then(n=>{q.success("保存成功"),y.value=!1,D("update")}).finally(()=>{b.value=!1})}).catch(n=>{console.log("error",n),b.value=!1})},k=()=>{U.value=!0,I.value.validate().then(()=>{const n={type:"SHARE_SAVE",taskInfos:JSON.stringify([{fileId:l.share_file_id,fileName:l.task_name,isFolder:1}]),targetFolderId:l.save_path_id,shareId:l.share_id};N.createBatchTask(n).then(e=>{q.success("一键转存成功"),y.value=!1,D("update")}).finally(()=>{U.value=!1})}).catch(n=>{q.error("一键转存失败"),U.value=!1})},te=()=>{window.open(l.share_url,"cloud")},K=()=>{y.value=!1},A=i({}),L=i(!1),H=(n,e)=>{let v="";console.log("isUrl >>>",e),e?(v=n.match(/\/t\/([^\/]+)/)[1]||"",console.log("code >>>",v),l.share_code=v):v=n,console.log("shareCode",n),N.getShareInfoByCode({shareCode:v}).then(u=>{const{shareMode:S,shareId:r,fileId:c,fileName:M,accessCode:B}=u;A.value={shareMode:S,shareId:String(r),fileId:c,accessCode:B},l.share_id=String(r),l.share_mode=S,l.share_file_id=c,l.task_name=M,l.access_code=B})},oe=n=>{l.share_file_id=n,A.value.fileId=n};return X(()=>{f.url&&(l.share_url=f.url,H(f.url,!0))}),(n,e)=>{const v=m("a-input-search"),u=m("a-form-item"),S=m("a-input"),r=m("a-select-option"),c=m("a-select"),M=m("a-input-number"),B=m("a-form"),$=m("a-button"),se=m("a-modal");return p(),O(z,null,[a(se,{maskClosable:!1,open:y.value,class:"ant-modal-dray",onCancel:K,width:"600px"},{title:t(()=>[h("div",{ref_key:"modalTitleRef",ref:F,class:"modal-title",style:{width:"100%",cursor:"move"}},G(f.isAdd?"新建任务":"编辑"),513)]),modalRender:t(({originVNode:o})=>[h("div",{ref_key:"modalRef",ref:w,style:ee(s(V))},[(p(),C(le(o)))],4)]),footer:t(()=>[h("div",_e,[h("div",null,[a($,{type:"primary",onClick:k,loading:U.value},{default:t(()=>e[33]||(e[33]=[d("一键转存")])),_:1},8,["loading"]),a($,{type:"primary",onClick:te},{default:t(()=>e[34]||(e[34]=[d("查看链接")])),_:1})]),h("div",null,[a($,{key:"back",onClick:K},{default:t(()=>e[35]||(e[35]=[d("取消")])),_:1}),a($,{key:"submit",loading:b.value,type:"primary",onClick:j},{default:t(()=>e[36]||(e[36]=[d("保存")])),_:1},8,["loading"])])])]),default:t(()=>[a(B,{ref_key:"formRef",ref:I,"label-col":_.labelCol,model:s(l),rules:Y,"wrapper-col":_.wrapperCol},{default:t(()=>[a(u,{label:"分享链接",name:"share_url"},{default:t(()=>[a(v,{value:s(l).share_url,"onUpdate:value":e[0]||(e[0]=o=>s(l).share_url=o),onSearch:e[1]||(e[1]=o=>H(o,!0))},null,8,["value"])]),_:1}),a(u,{label:"shareCode",name:"share_code"},{default:t(()=>[a(v,{value:s(l).share_code,"onUpdate:value":e[2]||(e[2]=o=>s(l).share_code=o),onSearch:e[3]||(e[3]=o=>H(o,!1))},null,8,["value"])]),_:1}),a(u,{label:"访问码",name:"access_code"},{default:t(()=>[a(S,{value:s(l).access_code,"onUpdate:value":e[4]||(e[4]=o=>s(l).access_code=o)},null,8,["value"])]),_:1}),a(u,{label:"任务名称",name:"task_name"},{default:t(()=>[a(S,{value:s(l).task_name,"onUpdate:value":e[5]||(e[5]=o=>s(l).task_name=o)},null,8,["value"])]),_:1}),a(u,{label:"分享ID",name:"share_id"},{default:t(()=>[a(S,{value:s(l).share_id,"onUpdate:value":e[6]||(e[6]=o=>s(l).share_id=o)},null,8,["value"])]),_:1}),a(u,{label:"分享目录ID",name:"share_file_id"},{default:t(()=>[a(v,{value:s(l).share_file_id,"onUpdate:value":e[7]||(e[7]=o=>s(l).share_file_id=o),onSearch:e[8]||(e[8]=o=>L.value=!0)},null,8,["value"])]),_:1}),a(u,{label:"分享模式",name:"share_mode"},{default:t(()=>[a(c,{value:s(l).share_mode,"onUpdate:value":e[9]||(e[9]=o=>s(l).share_mode=o),placeholder:"请选择"},{default:t(()=>[a(r,{value:3},{default:t(()=>e[23]||(e[23]=[d("3-普通pc链接")])),_:1}),a(r,{value:5},{default:t(()=>e[24]||(e[24]=[d("5-移动端订阅中心链接")])),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"保存目录ID",name:"save_path_id"},{default:t(()=>[a(v,{value:s(l).save_path_id,"onUpdate:value":e[10]||(e[10]=o=>s(l).save_path_id=o),onSearch:e[11]||(e[11]=o=>g.value=!0)},null,8,["value"])]),_:1}),a(u,{label:"任务状态",name:"status"},{default:t(()=>[a(c,{value:s(l).status,"onUpdate:value":e[12]||(e[12]=o=>s(l).status=o),placeholder:"请选择"},{default:t(()=>[a(r,{value:1},{default:t(()=>e[25]||(e[25]=[d("执行")])),_:1}),a(r,{value:2},{default:t(()=>e[26]||(e[26]=[d("暂停")])),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"保存模式",name:"save_type"},{default:t(()=>[a(c,{value:s(l).save_type,"onUpdate:value":e[13]||(e[13]=o=>s(l).save_type=o),placeholder:"请选择"},{default:t(()=>[a(r,{value:1},{default:t(()=>e[27]||(e[27]=[d("文件和文件夹（保存一次，文件内有更新无法同步）")])),_:1}),a(r,{value:0},{default:t(()=>e[28]||(e[28]=[d("仅文件")])),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"执行时间",name:"task_week"},{default:t(()=>[a(c,{value:s(l).task_week,"onUpdate:value":e[14]||(e[14]=o=>s(l).task_week=o),placeholder:"请选择",mode:"multiple"},{default:t(()=>[(p(!0),O(z,null,Z(x,o=>(p(),C(r,{value:o.value},{default:t(()=>[d(G(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(u,{label:"筛选文本",name:"filter_text"},{default:t(()=>[a(S,{value:s(l).filter_text,"onUpdate:value":e[15]||(e[15]=o=>s(l).filter_text=o),placeholder:"筛选文本"},null,8,["value"])]),_:1}),a(u,{label:"筛选文本模式",name:"filter_text_type"},{default:t(()=>[a(c,{value:s(l).filter_text_type,"onUpdate:value":e[16]||(e[16]=o=>s(l).filter_text_type=o),placeholder:"请选择"},{default:t(()=>[a(r,{value:1},{default:t(()=>e[29]||(e[29]=[d("包含")])),_:1}),a(r,{value:2},{default:t(()=>e[30]||(e[30]=[d("不包含")])),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"筛选集数",name:"episode_filter_num"},{default:t(()=>[a(M,{value:s(l).episode_filter_num,"onUpdate:value":e[17]||(e[17]=o=>s(l).episode_filter_num=o),placeholder:"筛选集数"},null,8,["value"])]),_:1}),a(u,{label:"筛选集数模式",name:"episode_filter_type"},{default:t(()=>[a(c,{value:s(l).episode_filter_type,"onUpdate:value":e[18]||(e[18]=o=>s(l).episode_filter_type=o),placeholder:"请选择"},{default:t(()=>[a(r,{value:1},{default:t(()=>e[31]||(e[31]=[d("大于")])),_:1}),a(r,{value:2},{default:t(()=>e[32]||(e[32]=[d("小于")])),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"总集数",name:"episode_total"},{default:t(()=>[a(M,{value:s(l).episode_total,"onUpdate:value":e[19]||(e[19]=o=>s(l).episode_total=o)},null,8,["value"])]),_:1}),a(u,{label:"更新集数",name:"episode"},{default:t(()=>[a(M,{value:s(l).episode,"onUpdate:value":e[20]||(e[20]=o=>s(l).episode=o)},null,8,["value"])]),_:1})]),_:1},8,["label-col","model","wrapper-col"])]),_:1},8,["open"]),g.value?(p(),C(ie,{key:0,modelValue:g.value,"onUpdate:modelValue":e[21]||(e[21]=o=>g.value=o),onOk:T,taskName:s(l).task_name},null,8,["modelValue","taskName"])):Q("",!0),L.value?(p(),C(pe,{key:1,modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=o=>L.value=o),options:A.value,onOk:oe},null,8,["modelValue","options"])):Q("",!0)],64)}}},he=me(ke,[["__scopeId","data-v-a5beb5c2"]]);export{he as N};
