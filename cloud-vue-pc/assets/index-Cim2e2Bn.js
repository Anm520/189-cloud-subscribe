import{r as v,q,j as l,f as h,c as n,d as U,n as i,H as F,b as S,e as u,A as y,o,g as s,v as G,x as _,P as J,k as g,t as f,y as V,S as Q,J as W,K as X,h as T,L as Z,M as ee,G as ae}from"./index-BKinuvNY.js";import{N as te}from"./NewTaskModel-CU5DWr2A.js";import"./useDayjs-DvWPZlnJ.js";import{u as ne}from"./CloudDisk-DhBrOmEO.js";import{_ as oe,e as le}from"./FileUpload-Dift3hGY.js";import{h as se}from"./index-CbH7X_L3.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-e72A2cof.js";import"./FolderTreeModel-D2cS3skF.js";const ue={class:"app-container"},de={class:"table-top"},re={style:{display:"flex"}},pe={style:{display:"flex","margin-right":"10px","align-items":"center"}},ce=["href"],ve={key:1},me=["onClick"],ke={key:0},_e={key:1},fe={key:2},ye={__name:"index",setup(ge){const x=v(!1),A=v(!0),w=v(),z=a=>{w.value=a,console.log("editRecord>>>>",w.value),A.value=!1,x.value=!0},k=v(!1),E=v(""),B=a=>{ee.confirm({title:"删除确认",icon:n(ae),content:n("div",{style:"color:red;"},`是否要删除任务： 《${a.task_name}》 ？`),okText:"删除",okButtonProps:{size:"small"},cancelButtonProps:{size:"small"},onOk(){return k.value=!0,y.deleteTask({list:[a.id]}).then(e=>{T.success("删除成功"),r()}).catch(e=>{k.value=!1})},onCancel(){}})},b=v([]),M=v([{title:"序号",dataIndex:"serial"},{title:"任务名称",dataIndex:"task_name"},{title:"任务状态",dataIndex:"status"},{title:"当前集数",dataIndex:"episode"},{title:"总集数",dataIndex:"episode_total"},{title:"保存目录ID",dataIndex:"save_path_id"},{title:"更新时间",dataIndex:"update_time"},{title:"创建帐号",dataIndex:"account"},{title:"操作",dataIndex:"operate"}]),m=v({current:1,pageSize:15,total:0,showTotal:a=>`共计 ${a} 条`}),r=()=>{k.value=!0;const a={current:m.value.current,pageSize:m.value.pageSize,task_name:E.value};y.getTaskList(a).then(e=>{console.log("🚀 ~ .then ~ res:",e),b.value=e.data,m.value.total=e.total}).finally(()=>{k.value=!1})},D=()=>{m.value.current=1,r()},L=({current:a})=>{console.log("pagination>>>>",a),m.value.current=a,r()};ne();const O=a=>{k.value=!0,y.runTask({id:a.id}).then(e=>{console.log("🚀 ~ .handleExecute ~ res:",e);let p=e.successedCount?`成功更新${e.successedCount}个文件`:e.res_message;T.success(p),setTimeout(()=>{r()},10)}).finally(()=>{k.value=!1})},I=v(!1),N=a=>{let e="";a=="account"&&(e=window.localStorage.getItem("account")),I.value=!0,y.runAllTask({account:e}).then(p=>{r(),T.success(p.res_message)}).finally(()=>{I.value=!1})};q(()=>{r()});const R=()=>{y.getAllTaskList().then(a=>{console.log("导出所有数据>>",a),le.exportToExcel(a,"任务列表.xlsx")})},Y=a=>{console.log("导入的数据",a);let e=[];a.forEach(p=>{p.task_week=p.task_week||"[8]",e.push(y.createTask(p))}),Promise.all(e).finally(()=>{T.success("导入成功"),r()})},H=a=>{Z.push({path:"/cloud/index",query:{path:a}})};return(a,e)=>{const p=S("a-input"),c=S("a-button"),P=S("a-space"),K=S("a-table");return o(),l("div",ue,[h("div",de,[h("div",re,[h("div",pe,[e[5]||(e[5]=h("span",null," 任务名称：",-1)),n(p,{value:E.value,"onUpdate:value":e[0]||(e[0]=t=>E.value=t),"allow-clear":"",style:{width:"180px"},onKeyup:F(D,["enter"])},null,8,["value"])]),n(c,{type:"primary",onClick:D},{default:u(()=>e[6]||(e[6]=[s("搜索")])),_:1})]),n(P,null,{default:u(()=>[n(c,{type:"primary",onClick:r},{default:u(()=>e[7]||(e[7]=[s("刷新")])),_:1}),n(c,{type:"primary",onClick:e[1]||(e[1]=t=>N("")),loading:I.value},{default:u(()=>e[8]||(e[8]=[s("全部执行")])),_:1},8,["loading"]),n(c,{type:"primary",onClick:e[2]||(e[2]=t=>N("account")),loading:I.value},{default:u(()=>e[9]||(e[9]=[s("执行当前账号")])),_:1},8,["loading"]),n(c,{type:"primary",onClick:R},{default:u(()=>e[10]||(e[10]=[s("导出任务")])),_:1}),n(oe,{onOk:Y}),n(c,{icon:G(_(J)),type:"primary",onClick:e[3]||(e[3]=t=>{x.value=!0,A.value=!0})},{default:u(()=>e[11]||(e[11]=[s("新建任务")])),_:1},8,["icon"])]),_:1})]),n(K,{columns:M.value,dataSource:b.value,loading:k.value,pagination:m.value,onChange:L},{bodyCell:u(({column:t,record:C,index:j,text:d})=>[t.dataIndex==="task_name"?(o(),l(g,{key:0},[C.share_url?(o(),l("a",{key:0,href:C.share_url,target:"_blank"},f(d),9,ce)):(o(),l("span",ve,f(d),1))],64)):i("",!0),t.dataIndex==="save_path_id"?(o(),l("a",{key:1,onClick:$=>H(d)},f(d),9,me)):i("",!0),t.dataIndex==="serial"?(o(),l(g,{key:2},[s(f((m.value.current-1)*m.value.pageSize+j+1),1)],64)):i("",!0),t.dataIndex==="create_time"?(o(),l(g,{key:3},[s(f(d?_(V)(d).format("YYYY-MM-DD HH:mm:ss"):""),1)],64)):i("",!0),t.dataIndex==="update_time"?(o(),l(g,{key:4},[s(f(_(V)(d).fromNow()),1)],64)):i("",!0),t.dataIndex==="account"?(o(),l(g,{key:5},[s(f(_(se)(d)),1)],64)):i("",!0),t.dataIndex==="status"?(o(),l(g,{key:6},[d===_(Q)?(o(),l("span",ke,"执行")):i("",!0),d===_(W)?(o(),l("span",_e,"暂停")):i("",!0),d===_(X)?(o(),l("span",fe,"完结")):i("",!0)],64)):i("",!0),t.dataIndex==="operate"?(o(),U(P,{key:7},{default:u(()=>[n(c,{onClick:$=>O(C)},{default:u(()=>e[12]||(e[12]=[s("执行")])),_:2},1032,["onClick"]),n(c,{onClick:$=>z(C)},{default:u(()=>e[13]||(e[13]=[s("编辑")])),_:2},1032,["onClick"]),n(c,{onClick:$=>B(C)},{default:u(()=>e[14]||(e[14]=[s("删除")])),_:2},1032,["onClick"])]),_:2},1024)):i("",!0)]),_:1},8,["columns","dataSource","loading","pagination"]),x.value?(o(),U(te,{key:0,modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),isAdd:A.value,record:w.value,onUpdate:r},null,8,["modelValue","isAdd","record"])):i("",!0)])}}},$e=ie(ye,[["__scopeId","data-v-fd2df461"]]);export{$e as default};
