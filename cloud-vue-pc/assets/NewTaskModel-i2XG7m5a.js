import{m as $,r,u as G,q as z,A as T,b as i,d as V,o as _,e as t,c as l,j as L,k as K,l as le,g as v,t as Q,f as I,C as W,x as s,B as X,a as J,w as oe,n as te,h as B,y as se,V as ne,E as de}from"./index-DYztBfRV.js";import{a as Z}from"./index-BIV3kDU7.js";import{F as re}from"./FolderTreeModel-CtigopAG.js";import{u as ue}from"./CloudDisk-BCrIu-am.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={key:0},fe={__name:"ShareFileIdSelectModal",props:$(["options"],{modelValue:{},modelModifiers:{}}),emits:$(["ok"],["update:modelValue"]),setup(u,{emit:q}){const y=r(""),h=r([]),F=r(null),D=r(null),N=Z(D,F),U=G(u,"modelValue"),c=r(!1),k=r(!1),g=q;z(()=>{console.log("options",u.options),k.value=!0;const R={noCache:Math.random(),...u.options,shareDirFileId:u.options.fileId,isFolder:!0,orderBy:"filename",descending:!1};T.getListShareDir(R).then(a=>{console.log("getListShareDir >>>>>:",a),h.value=a.fileListAO.folderList,c.value=a.fileListAO.folderList.length==0}).finally(()=>{k.value=!1})});const M=()=>{g("ok",y.value),U.value=!1};return(R,a)=>{const E=i("a-radio"),b=i("a-radio-group"),Y=i("a-spin"),j=i("a-modal");return _(),V(j,{open:U.value,"wrap-style":{overflow:"hidden"},onOk:M,onCancel:a[1]||(a[1]=m=>U.value=!1),class:"ant-modal-dray"},{title:t(()=>[I("div",{ref_key:"modalTitleRef",ref:F,class:"modal-title",style:{width:"100%",cursor:"move"}},"分享目录选择",512)]),modalRender:t(({originVNode:m})=>[I("div",{ref_key:"modalRef",ref:D,style:W(s(N))},[(_(),V(X(m)))],4)]),default:t(()=>[l(Y,{spinning:k.value},{default:t(()=>[c.value?(_(),L("div",me,"该目录下无文件夹")):(_(),V(b,{key:1,value:y.value,"onUpdate:value":a[0]||(a[0]=m=>y.value=m)},{default:t(()=>[(_(!0),L(K,null,le(h.value,m=>(_(),L("div",{key:m.id},[l(E,{value:m.id},{default:t(()=>[v(Q(m.name),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"]))]),_:1},8,["spinning"])]),_:1},8,["open"])}}},ve={class:"footer-btn"},pe={__name:"NewTaskModel",props:$({isAdd:Boolean,record:Object,url:String},{modelValue:{},modelModifiers:{}}),emits:$(["update"],["update:modelValue"]),setup(u,{emit:q}){const y=ue(),h=r(!1),F=n=>{a.save_path_id=n.id},D=r(null),N=r(null),U=Z(N,D),c=G(u,"modelValue"),k=q,g=r(!1),M=r(),R={labelCol:{span:5},wrapperCol:{span:13}};z(()=>{});let a=J({task_name:"",status:1,share_id:"",share_file_id:"",access_code:"",description:"",save_path_id:"",share_mode:3,share_code:"",share_url:"",save_type:0,episode_total:0,episode:0});oe(()=>u.record,n=>{u.isAdd||(a=J({...ne(n),create_time:se(n.create_time).format("YYYY-MM-DD HH:mm:ss"),update_time:""}),de(()=>{O.value={shareMode:n.share_mode,shareId:n.share_id,fileId:n.share_file_id,accessCode:n.access_code}}))},{deep:!0,immediate:!0});const E={share_id:[{required:!0,message:"请输入分享ID",trigger:"blur"}],share_file_id:[{required:!0,message:"请输入分享目录ID",trigger:"blur"}],status:[{required:!0,message:"Please select activity resource",trigger:"change"}],save_type:[{required:!0,message:"请选择",trigger:"change"}]},b=r(!1),Y=()=>{g.value=!0,M.value.validate().then(async()=>{u.isAdd?T.createTask({...a,account:y.CloudDiskUserInfo.account}).then(n=>{B.success("保存成功"),c.value=!1,k("update")}).finally(()=>{g.value=!1}):T.updateTask({...a,account:y.CloudDiskUserInfo.account}).then(n=>{B.success("保存成功"),c.value=!1,k("update")}).finally(()=>{g.value=!1})}).catch(n=>{console.log("error",n),g.value=!1})},j=()=>{b.value=!0,M.value.validate().then(()=>{const n={type:"SHARE_SAVE",taskInfos:JSON.stringify([{fileId:a.share_file_id,fileName:a.task_name,isFolder:1}]),targetFolderId:a.save_path_id,shareId:a.share_id};T.createBatchTask(n).then(e=>{B.success("一键转存成功"),c.value=!1,k("update")}).finally(()=>{b.value=!1})}).catch(n=>{B.error("一键转存失败"),b.value=!1})},m=()=>{c.value=!1},O=r({}),w=r(!1),H=(n,e)=>{let f="";console.log("isUrl >>>",e),e?(f=n.match(/\/t\/([^\/]+)/)[1]||"",console.log("code >>>",f),a.share_code=f):f=n,console.log("shareCode",n),T.getShareInfoByCode({shareCode:f}).then(d=>{const{shareMode:C,shareId:p,fileId:S,fileName:A,accessCode:x}=d;O.value={shareMode:C,shareId:String(p),fileId:S,accessCode:x},a.share_id=String(p),a.share_mode=C,a.share_file_id=S,a.task_name=A,a.access_code=x})},ee=n=>{a.share_file_id=n,O.value.fileId=n};return z(()=>{u.url&&(a.share_url=u.url,H(u.url,!0))}),(n,e)=>{const f=i("a-input-search"),d=i("a-form-item"),C=i("a-input"),p=i("a-select-option"),S=i("a-select"),A=i("a-input-number"),x=i("a-form"),P=i("a-button"),ae=i("a-modal");return _(),L(K,null,[l(ae,{maskClosable:!1,open:c.value,class:"ant-modal-dray",onCancel:m,width:"600px"},{title:t(()=>[I("div",{ref_key:"modalTitleRef",ref:D,class:"modal-title",style:{width:"100%",cursor:"move"}},Q(u.isAdd?"新建任务":"编辑"),513)]),modalRender:t(({originVNode:o})=>[I("div",{ref_key:"modalRef",ref:N,style:W(s(U))},[(_(),V(X(o)))],4)]),footer:t(()=>[I("div",ve,[l(P,{type:"primary",onClick:j,loading:b.value},{default:t(()=>e[24]||(e[24]=[v("一键转存")])),_:1},8,["loading"]),I("div",null,[l(P,{key:"back",onClick:m},{default:t(()=>e[25]||(e[25]=[v("取消")])),_:1}),l(P,{key:"submit",loading:g.value,type:"primary",onClick:Y},{default:t(()=>e[26]||(e[26]=[v("保存")])),_:1},8,["loading"])])])]),default:t(()=>[l(x,{ref_key:"formRef",ref:M,"label-col":R.labelCol,model:s(a),rules:E,"wrapper-col":R.wrapperCol},{default:t(()=>[l(d,{label:"分享链接",name:"share_url"},{default:t(()=>[l(f,{value:s(a).share_url,"onUpdate:value":e[0]||(e[0]=o=>s(a).share_url=o),onSearch:e[1]||(e[1]=o=>H(o,!0))},null,8,["value"])]),_:1}),l(d,{label:"shareCode",name:"share_code"},{default:t(()=>[l(f,{value:s(a).share_code,"onUpdate:value":e[2]||(e[2]=o=>s(a).share_code=o),onSearch:e[3]||(e[3]=o=>H(o,!1))},null,8,["value"])]),_:1}),l(d,{label:"访问码",name:"access_code"},{default:t(()=>[l(C,{value:s(a).access_code,"onUpdate:value":e[4]||(e[4]=o=>s(a).access_code=o)},null,8,["value"])]),_:1}),l(d,{label:"任务名称",name:"task_name"},{default:t(()=>[l(C,{value:s(a).task_name,"onUpdate:value":e[5]||(e[5]=o=>s(a).task_name=o)},null,8,["value"])]),_:1}),l(d,{label:"分享ID",name:"share_id"},{default:t(()=>[l(C,{value:s(a).share_id,"onUpdate:value":e[6]||(e[6]=o=>s(a).share_id=o)},null,8,["value"])]),_:1}),l(d,{label:"分享目录ID",name:"share_file_id"},{default:t(()=>[l(f,{value:s(a).share_file_id,"onUpdate:value":e[7]||(e[7]=o=>s(a).share_file_id=o),onSearch:e[8]||(e[8]=o=>w.value=!0)},null,8,["value"])]),_:1}),l(d,{label:"分享模式",name:"share_mode"},{default:t(()=>[l(S,{value:s(a).share_mode,"onUpdate:value":e[9]||(e[9]=o=>s(a).share_mode=o),placeholder:"请选择"},{default:t(()=>[l(p,{value:3},{default:t(()=>e[18]||(e[18]=[v("3-普通pc链接")])),_:1}),l(p,{value:5},{default:t(()=>e[19]||(e[19]=[v("5-移动端订阅中心链接")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"保存目录ID",name:"save_path_id"},{default:t(()=>[l(f,{value:s(a).save_path_id,"onUpdate:value":e[10]||(e[10]=o=>s(a).save_path_id=o),onSearch:e[11]||(e[11]=o=>h.value=!0)},null,8,["value"])]),_:1}),l(d,{label:"任务状态",name:"status"},{default:t(()=>[l(S,{value:s(a).status,"onUpdate:value":e[12]||(e[12]=o=>s(a).status=o),placeholder:"请选择"},{default:t(()=>[l(p,{value:1},{default:t(()=>e[20]||(e[20]=[v("执行")])),_:1}),l(p,{value:2},{default:t(()=>e[21]||(e[21]=[v("暂停")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"保存模式",name:"save_type"},{default:t(()=>[l(S,{value:s(a).save_type,"onUpdate:value":e[13]||(e[13]=o=>s(a).save_type=o),placeholder:"请选择"},{default:t(()=>[l(p,{value:1},{default:t(()=>e[22]||(e[22]=[v("文件和文件夹（保存一次，文件内有更新无法同步）")])),_:1}),l(p,{value:0},{default:t(()=>e[23]||(e[23]=[v("仅文件")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"总集数",name:"episode_total"},{default:t(()=>[l(A,{value:s(a).episode_total,"onUpdate:value":e[14]||(e[14]=o=>s(a).episode_total=o)},null,8,["value"])]),_:1}),l(d,{label:"更新集数",name:"episode"},{default:t(()=>[l(A,{value:s(a).episode,"onUpdate:value":e[15]||(e[15]=o=>s(a).episode=o)},null,8,["value"])]),_:1})]),_:1},8,["label-col","model","wrapper-col"])]),_:1},8,["open"]),l(re,{modelValue:h.value,"onUpdate:modelValue":e[16]||(e[16]=o=>h.value=o),onOk:F,taskName:s(a).task_name},null,8,["modelValue","taskName"]),w.value?(_(),V(fe,{key:0,modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=o=>w.value=o),options:O.value,onOk:ee},null,8,["modelValue","options"])):te("",!0)],64)}}},he=ie(pe,[["__scopeId","data-v-f652e95d"]]);export{he as N};
