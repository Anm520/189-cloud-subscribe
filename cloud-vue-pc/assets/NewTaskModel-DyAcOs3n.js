import{m as $,r,u as K,q as z,A as V,b as i,d as D,o as p,e as t,c as l,j as L,k as Q,l as oe,g as v,t as W,f as I,C as X,x as s,B as Z,a as J,w as te,n as G,h as B,y as se,V as ne,E as de}from"./index-DVWsMLSs.js";import{a as ee}from"./index-BUYeriUm.js";import{F as re}from"./FolderTreeModel-B5amu0cV.js";import{u as ue}from"./CloudDisk-CFN3zckg.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={key:0},fe={__name:"ShareFileIdSelectModal",props:$(["options"],{modelValue:{},modelModifiers:{}}),emits:$(["ok"],["update:modelValue"]),setup(u,{emit:q}){const h=r(""),k=r([]),F=r(null),U=r(null),N=ee(U,F),M=K(u,"modelValue"),c=r(!1),g=r(!1),y=q;z(()=>{console.log("options",u.options),g.value=!0;const T={noCache:Math.random(),...u.options,shareDirFileId:u.options.fileId,isFolder:!0,orderBy:"filename",descending:!1};V.getListShareDir(T).then(a=>{console.log("getListShareDir >>>>>:",a),k.value=a.fileListAO.folderList,c.value=a.fileListAO.folderList.length==0}).finally(()=>{g.value=!1})});const R=()=>{y("ok",h.value),M.value=!1};return(T,a)=>{const E=i("a-radio"),b=i("a-radio-group"),Y=i("a-spin"),j=i("a-modal");return p(),D(j,{open:M.value,"wrap-style":{overflow:"hidden"},onOk:R,onCancel:a[1]||(a[1]=m=>M.value=!1),class:"ant-modal-dray"},{title:t(()=>[I("div",{ref_key:"modalTitleRef",ref:F,class:"modal-title",style:{width:"100%",cursor:"move"}},"分享目录选择",512)]),modalRender:t(({originVNode:m})=>[I("div",{ref_key:"modalRef",ref:U,style:X(s(N))},[(p(),D(Z(m)))],4)]),default:t(()=>[l(Y,{spinning:g.value},{default:t(()=>[c.value?(p(),L("div",me,"该目录下无文件夹")):(p(),D(b,{key:1,value:h.value,"onUpdate:value":a[0]||(a[0]=m=>h.value=m)},{default:t(()=>[(p(!0),L(Q,null,oe(k.value,m=>(p(),L("div",{key:m.id},[l(E,{value:m.id},{default:t(()=>[v(W(m.name),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["value"]))]),_:1},8,["spinning"])]),_:1},8,["open"])}}},ve={class:"footer-btn"},pe={__name:"NewTaskModel",props:$({isAdd:Boolean,record:Object,url:String},{modelValue:{},modelModifiers:{}}),emits:$(["update"],["update:modelValue"]),setup(u,{emit:q}){const h=ue(),k=r(!1),F=n=>{a.save_path_id=n.id},U=r(null),N=r(null),M=ee(N,U),c=K(u,"modelValue"),g=q,y=r(!1),R=r(),T={labelCol:{span:5},wrapperCol:{span:13}};z(()=>{});let a=J({task_name:"",status:1,share_id:"",share_file_id:"",access_code:"",description:"",save_path_id:"",share_mode:3,share_code:"",share_url:"",save_type:0,episode_total:0,episode:0});te(()=>u.record,n=>{u.isAdd||(a=J({...ne(n),create_time:se(n.create_time).format("YYYY-MM-DD HH:mm:ss"),update_time:""}),de(()=>{O.value={shareMode:n.share_mode,shareId:n.share_id,fileId:n.share_file_id,accessCode:n.access_code}}))},{deep:!0,immediate:!0});const E={share_id:[{required:!0,message:"请输入分享ID",trigger:"blur"}],share_file_id:[{required:!0,message:"请输入分享目录ID",trigger:"blur"}],status:[{required:!0,message:"Please select activity resource",trigger:"change"}],save_type:[{required:!0,message:"请选择",trigger:"change"}]},b=r(!1),Y=()=>{y.value=!0,R.value.validate().then(async()=>{u.isAdd?V.createTask({...a,account:h.CloudDiskUserInfo.account}).then(n=>{B.success("保存成功"),c.value=!1,g("update")}).finally(()=>{y.value=!1}):V.updateTask({...a,account:h.CloudDiskUserInfo.account}).then(n=>{B.success("保存成功"),c.value=!1,g("update")}).finally(()=>{y.value=!1})}).catch(n=>{console.log("error",n),y.value=!1})},j=()=>{b.value=!0,R.value.validate().then(()=>{const n={type:"SHARE_SAVE",taskInfos:JSON.stringify([{fileId:a.share_file_id,fileName:a.task_name,isFolder:1}]),targetFolderId:a.save_path_id,shareId:a.share_id};V.createBatchTask(n).then(e=>{B.success("一键转存成功"),c.value=!1,g("update")}).finally(()=>{b.value=!1})}).catch(n=>{B.error("一键转存失败"),b.value=!1})},m=()=>{c.value=!1},O=r({}),w=r(!1),H=(n,e)=>{let f="";console.log("isUrl >>>",e),e?(f=n.match(/\/t\/([^\/]+)/)[1]||"",console.log("code >>>",f),a.share_code=f):f=n,console.log("shareCode",n),V.getShareInfoByCode({shareCode:f}).then(d=>{const{shareMode:C,shareId:_,fileId:S,fileName:A,accessCode:x}=d;O.value={shareMode:C,shareId:String(_),fileId:S,accessCode:x},a.share_id=String(_),a.share_mode=C,a.share_file_id=S,a.task_name=A,a.access_code=x})},ae=n=>{a.share_file_id=n,O.value.fileId=n};return z(()=>{u.url&&(a.share_url=u.url,H(u.url,!0))}),(n,e)=>{const f=i("a-input-search"),d=i("a-form-item"),C=i("a-input"),_=i("a-select-option"),S=i("a-select"),A=i("a-input-number"),x=i("a-form"),P=i("a-button"),le=i("a-modal");return p(),L(Q,null,[l(le,{maskClosable:!1,open:c.value,class:"ant-modal-dray",onCancel:m,width:"600px"},{title:t(()=>[I("div",{ref_key:"modalTitleRef",ref:U,class:"modal-title",style:{width:"100%",cursor:"move"}},W(u.isAdd?"新建任务":"编辑"),513)]),modalRender:t(({originVNode:o})=>[I("div",{ref_key:"modalRef",ref:N,style:X(s(M))},[(p(),D(Z(o)))],4)]),footer:t(()=>[I("div",ve,[l(P,{type:"primary",onClick:j,loading:b.value},{default:t(()=>e[24]||(e[24]=[v("一键转存")])),_:1},8,["loading"]),I("div",null,[l(P,{key:"back",onClick:m},{default:t(()=>e[25]||(e[25]=[v("取消")])),_:1}),l(P,{key:"submit",loading:y.value,type:"primary",onClick:Y},{default:t(()=>e[26]||(e[26]=[v("保存")])),_:1},8,["loading"])])])]),default:t(()=>[l(x,{ref_key:"formRef",ref:R,"label-col":T.labelCol,model:s(a),rules:E,"wrapper-col":T.wrapperCol},{default:t(()=>[l(d,{label:"分享链接",name:"share_url"},{default:t(()=>[l(f,{value:s(a).share_url,"onUpdate:value":e[0]||(e[0]=o=>s(a).share_url=o),onSearch:e[1]||(e[1]=o=>H(o,!0))},null,8,["value"])]),_:1}),l(d,{label:"shareCode",name:"share_code"},{default:t(()=>[l(f,{value:s(a).share_code,"onUpdate:value":e[2]||(e[2]=o=>s(a).share_code=o),onSearch:e[3]||(e[3]=o=>H(o,!1))},null,8,["value"])]),_:1}),l(d,{label:"访问码",name:"access_code"},{default:t(()=>[l(C,{value:s(a).access_code,"onUpdate:value":e[4]||(e[4]=o=>s(a).access_code=o)},null,8,["value"])]),_:1}),l(d,{label:"任务名称",name:"task_name"},{default:t(()=>[l(C,{value:s(a).task_name,"onUpdate:value":e[5]||(e[5]=o=>s(a).task_name=o)},null,8,["value"])]),_:1}),l(d,{label:"分享ID",name:"share_id"},{default:t(()=>[l(C,{value:s(a).share_id,"onUpdate:value":e[6]||(e[6]=o=>s(a).share_id=o)},null,8,["value"])]),_:1}),l(d,{label:"分享目录ID",name:"share_file_id"},{default:t(()=>[l(f,{value:s(a).share_file_id,"onUpdate:value":e[7]||(e[7]=o=>s(a).share_file_id=o),onSearch:e[8]||(e[8]=o=>w.value=!0)},null,8,["value"])]),_:1}),l(d,{label:"分享模式",name:"share_mode"},{default:t(()=>[l(S,{value:s(a).share_mode,"onUpdate:value":e[9]||(e[9]=o=>s(a).share_mode=o),placeholder:"请选择"},{default:t(()=>[l(_,{value:3},{default:t(()=>e[18]||(e[18]=[v("3-普通pc链接")])),_:1}),l(_,{value:5},{default:t(()=>e[19]||(e[19]=[v("5-移动端订阅中心链接")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"保存目录ID",name:"save_path_id"},{default:t(()=>[l(f,{value:s(a).save_path_id,"onUpdate:value":e[10]||(e[10]=o=>s(a).save_path_id=o),onSearch:e[11]||(e[11]=o=>k.value=!0)},null,8,["value"])]),_:1}),l(d,{label:"任务状态",name:"status"},{default:t(()=>[l(S,{value:s(a).status,"onUpdate:value":e[12]||(e[12]=o=>s(a).status=o),placeholder:"请选择"},{default:t(()=>[l(_,{value:1},{default:t(()=>e[20]||(e[20]=[v("执行")])),_:1}),l(_,{value:2},{default:t(()=>e[21]||(e[21]=[v("暂停")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"保存模式",name:"save_type"},{default:t(()=>[l(S,{value:s(a).save_type,"onUpdate:value":e[13]||(e[13]=o=>s(a).save_type=o),placeholder:"请选择"},{default:t(()=>[l(_,{value:1},{default:t(()=>e[22]||(e[22]=[v("文件和文件夹（保存一次，文件内有更新无法同步）")])),_:1}),l(_,{value:0},{default:t(()=>e[23]||(e[23]=[v("仅文件")])),_:1})]),_:1},8,["value"])]),_:1}),l(d,{label:"总集数",name:"episode_total"},{default:t(()=>[l(A,{value:s(a).episode_total,"onUpdate:value":e[14]||(e[14]=o=>s(a).episode_total=o)},null,8,["value"])]),_:1}),l(d,{label:"更新集数",name:"episode"},{default:t(()=>[l(A,{value:s(a).episode,"onUpdate:value":e[15]||(e[15]=o=>s(a).episode=o)},null,8,["value"])]),_:1})]),_:1},8,["label-col","model","wrapper-col"])]),_:1},8,["open"]),k.value?(p(),D(re,{key:0,modelValue:k.value,"onUpdate:modelValue":e[16]||(e[16]=o=>k.value=o),onOk:F,taskName:s(a).task_name},null,8,["modelValue","taskName"])):G("",!0),w.value?(p(),D(fe,{key:1,modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=o=>w.value=o),options:O.value,onOk:ae},null,8,["modelValue","options"])):G("",!0)],64)}}},he=ie(pe,[["__scopeId","data-v-3d97ab7e"]]);export{he as N};
