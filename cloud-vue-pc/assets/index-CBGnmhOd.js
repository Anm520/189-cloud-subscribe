import{_ as _e,g as ye}from"./index-CgFVIvyu.js";import{c as t,I as ue,m as te,F as ce,r as k,u as me,a as Q,w as ne,b as p,d as oe,o as _,e as o,f as c,g as h,A as z,h as B,i as se,j as g,k as J,l as Y,t as N,n as H,p as ge,R as le,q as Fe,s as be,v as q,x as $,P as we,D as de,y as ke,z as he}from"./index-B62j_sKj.js";import"./useDayjs-DP_NlzOV.js";import{_ as Oe,F as Re}from"./FolderTreeModel-Dl27k8uG.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Se}from"./index-C3osfzhn.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"}}]},name:"form",theme:"outlined"};function re(m){for(var d=1;d<arguments.length;d++){var r=arguments[d]!=null?Object(arguments[d]):{},a=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable}))),a.forEach(function(s){Ie(m,s,r[s])})}return m}function Ie(m,d,r){return d in m?Object.defineProperty(m,d,{value:r,enumerable:!0,configurable:!0,writable:!0}):m[d]=r,m}var G=function(d,r){var a=re({},d,r.attrs);return t(ue,re({},a,{icon:xe}),null)};G.displayName="FormOutlined";G.inheritAttrs=!1;var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function ie(m){for(var d=1;d<arguments.length;d++){var r=arguments[d]!=null?Object(arguments[d]):{},a=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable}))),a.forEach(function(s){Ne(m,s,r[s])})}return m}function Ne(m,d,r){return d in m?Object.defineProperty(m,d,{value:r,enumerable:!0,configurable:!0,writable:!0}):m[d]=r,m}var ae=function(d,r){var a=ie({},d,r.attrs);return t(ue,ie({},a,{icon:$e}),null)};ae.displayName="SyncOutlined";ae.inheritAttrs=!1;const Ve={style:{height:"60px","padding-top":"20px"}},Me={__name:"RenameFolderModel",props:te({record:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:te(["update:update"],["update:modelValue"]),setup(m,{emit:d}){const r=ce.useForm,a=k(!1),s=me(m,"modelValue"),E=d,S=m,F=Q({folderId:"",destFolderName:""});ne(()=>S.record,y=>{console.log("ðŸš€ ~ record:",y),F.folderId=String(y.id),F.destFolderName=y.name},{deep:!0});const b=Q({destFolderName:[{required:!0,message:"è¯·å¡«å†™"}]}),{resetFields:l,validate:U,validateInfos:Z}=r(F,b),M=()=>{a.value=!0,U().then(()=>{console.log(F),z.renameFolder({...F,Cookie:document.cookie,noCache:Math.random()}).then(y=>{console.log("ðŸš€ ~ API.renameFolder ~ res:",y),B.success("é‡å‘½åæˆåŠŸ"),E("update"),s.value=!1}).finally(()=>{a.value=!1})}).catch(y=>{console.log("error",y),a.value=!1})},j=()=>{s.value=!1},V=y=>{console.log("Failed:",y)};return(y,O)=>{const x=p("a-input"),D=p("a-form-item"),A=p("a-form"),K=p("a-button"),u=p("a-modal");return _(),oe(u,{open:s.value,"onUpdate:open":O[1]||(O[1]=n=>s.value=n),title:"é‡å‘½å",onOk:M},{footer:o(()=>[t(K,{key:"back",onClick:j},{default:o(()=>O[2]||(O[2]=[h("å–æ¶ˆ")])),_:1}),t(K,{key:"submit",type:"primary",loading:a.value,onClick:M},{default:o(()=>O[3]||(O[3]=[h("ç¡®è®¤")])),_:1},8,["loading"])]),default:o(()=>[c("div",Ve,[t(A,{model:F,name:"basic","label-col":{span:4},"wrapper-col":{span:16},autocomplete:"off",onFinish:M,onFinishFailed:V},{default:o(()=>[t(D,{label:"æ–‡ä»¶å",name:"destFolderName"},{default:o(()=>[t(x,{value:F.destFolderName,"onUpdate:value":O[0]||(O[0]=n=>F.destFolderName=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])}}},Te={style:{display:"flex"}},Pe={class:""},Le={style:{"margin-left":"10px"}},Ue={class:""},Ae={key:0},ze={style:{color:"red"}},Be={style:{display:"flex"}},Ee={class:""},je=["innerHTML"],De={style:{"margin-left":"10px"}},Ke={class:""},qe=["innerHTML"],He={__name:"BatchRenameFolderModel",props:te({selectedRows:{type:Array,default:()=>[]}},{modelValue:{},modelModifiers:{}}),emits:te(["update:update"],["update:modelValue"]),setup(m,{emit:d}){const r=ce.useForm,a=k(!1),s=me(m,"modelValue"),E=d,S=m,F=k("2"),b=Q({oldStr:"",newStr:""}),l=Q({destFolderName:"",num:1,end:""});ne(()=>S.selectedRows,u=>{},{deep:!0,immediate:!0});const U=Q({destFolderName:[{required:!0,message:"è¯·å¡«å†™"}],num:[{required:!0,message:"è¯·å¡«å†™"}],end:[{required:!0,message:"è¯·å¡«å†™"}]}),{resetFields:Z,validate:M,validateInfos:j}=r(l,U);function V(u){let n=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return console.log("newStr >>>",n),n}const y=()=>{a.value=!0,F.value==="1"?M().then(()=>{S.selectedRows.forEach((u,n)=>{const T=n+l.num>9?n+l.num:"0"+(n+l.num);setTimeout(()=>{z.renameFolder({folderId:u.id,destFolderName:l.destFolderName+T+l.end})},300)}),setTimeout(()=>{B.success("æ‰¹é‡é‡å‘½åæˆåŠŸï¼"),a.value=!1,E("update"),s.value=!1},1e3)}).catch(u=>{console.log("error",u),a.value=!1}):(S.selectedRows.forEach((u,n)=>{setTimeout(()=>{z.renameFolder({folderId:u.id,destFolderName:u.name.replace(new RegExp(V(b.oldStr),"g"),b.newStr)})},300)}),setTimeout(()=>{B.success("æ‰¹é‡é‡å‘½åæˆåŠŸï¼"),a.value=!1,E("update"),s.value=!1},1e3))},O=()=>{s.value=!1},x=u=>{console.log("Success:",u)},D=u=>{console.log("Failed:",u)},A=se(()=>S.selectedRows.map(u=>({name:b.oldStr?u.name.replace(new RegExp(V(b.oldStr),"g"),function(n){return`<span style="color:red;">${n}</span>`}):u.name,id:u.id}))),K=se(()=>S.selectedRows.map(u=>({name:b.newStr&&b.oldStr?u.name.replace(new RegExp(V(b.oldStr),"g"),function(n){return`<span style="color:red;">${b.newStr}</span>`}):u.name,id:u.id})));return(u,n)=>{const T=p("a-input"),W=p("a-form-item"),i=p("a-input-number"),e=p("a-form"),R=p("a-tab-pane"),w=p("a-space"),C=p("a-tabs"),X=p("a-button"),P=p("a-modal");return _(),oe(P,{open:s.value,"onUpdate:open":n[6]||(n[6]=f=>s.value=f),title:"æ‰¹é‡é‡å‘½å",onOk:y,width:"1500px"},{footer:o(()=>[t(X,{key:"back",onClick:O},{default:o(()=>n[11]||(n[11]=[h("å–æ¶ˆ")])),_:1}),t(X,{key:"submit",type:"primary",loading:a.value,onClick:y},{default:o(()=>n[12]||(n[12]=[h("ç¡®è®¤")])),_:1},8,["loading"])]),default:o(()=>[c("div",null,[t(C,{activeKey:F.value,"onUpdate:activeKey":n[5]||(n[5]=f=>F.value=f)},{default:o(()=>[t(R,{key:"1",tab:"æŒ‰é¡ºåºæ›¿æ¢"},{default:o(()=>[t(e,{model:l,name:"basic",autocomplete:"off",onFinish:x,onFinishFailed:D},{default:o(()=>[t(W,{label:"å¼€å§‹å­—ç¬¦",name:"destFolderName"},{default:o(()=>[t(T,{value:l.destFolderName,"onUpdate:value":n[0]||(n[0]=f=>l.destFolderName=f)},null,8,["value"])]),_:1}),t(W,{label:"å¼€å§‹æ•°å­—",name:"num"},{default:o(()=>[t(i,{value:l.num,"onUpdate:value":n[1]||(n[1]=f=>l.num=f),style:{width:"120px"}},null,8,["value"])]),_:1}),t(W,{label:"ç»“å°¾",name:"end"},{default:o(()=>[t(T,{value:l.end,"onUpdate:value":n[2]||(n[2]=f=>l.end=f),style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),c("div",Te,[c("div",null,[(_(!0),g(J,null,Y(S.selectedRows,(f,L)=>(_(),g("div",Pe,N(f.name),1))),256))]),c("div",Le,[(_(!0),g(J,null,Y(S.selectedRows,(f,L)=>(_(),g("div",Ue,[l.destFolderName?(_(),g("span",Ae,[c("span",ze,N(l.destFolderName),1),h(" "+N(L+l.num>9?L+l.num:"0"+(L+l.num))+N(l.end),1)])):H("",!0)]))),256))]),n[7]||(n[7]=c("div",null,null,-1))])]),_:1}),t(R,{key:"2",tab:"æŒ‰å­—ç¬¦æ›¿æ¢"},{default:o(()=>[t(w,null,{default:o(()=>[n[9]||(n[9]=c("div",null,"åŒ¹é…å­—ç¬¦ï¼š",-1)),t(T,{value:b.oldStr,"onUpdate:value":n[3]||(n[3]=f=>b.oldStr=f),style:{width:"500px"}},null,8,["value"]),t(w,null,{default:o(()=>[n[8]||(n[8]=c("div",null,"æ›¿æ¢å­—ç¬¦ï¼š",-1)),t(T,{value:b.newStr,"onUpdate:value":n[4]||(n[4]=f=>b.newStr=f),style:{width:"500px"}},null,8,["value"])]),_:1})]),_:1}),c("div",Be,[c("div",null,[(_(!0),g(J,null,Y(A.value,(f,L)=>(_(),g("div",Ee,[c("span",{innerHTML:f.name},null,8,je)]))),256))]),c("div",De,[(_(!0),g(J,null,Y(K.value,(f,L)=>(_(),g("div",Ke,[c("span",{innerHTML:f.name},null,8,qe)]))),256))]),n[10]||(n[10]=c("div",null,null,-1))])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["open"])}}},Je={class:"cloud-disk"},Ge={class:"files-view"},Qe={class:"table-top"},We={class:"table-top"},Xe={class:"center"},Ye=["onClick"],Ze={key:0,alt:"",src:_e,style:{width:"28px",height:"28px","margin-right":"10px"}},et={key:0},tt={key:1},nt={key:2},lt={key:3},ot=["onClick"],at=["onClick"],st={__name:"FilesView",setup(m){const r=ge().query.path,a=k([{name:"æ ¹ç›®å½•",id:le}]),s=k(r||le);Fe(()=>{r&&n()});const{copy:E}=Se({legacy:!0}),S=()=>{E(s.value).then(()=>{B.success("å¤åˆ¶æˆåŠŸ")}).catch(i=>{B.error("å¤åˆ¶å¤±è´¥")})},F=k(!1),b=k([{title:"æ–‡ä»¶å",dataIndex:"name",key:"name",width:"40%"},{title:"å¤§å°",dataIndex:"size",key:"size"},{title:"ä¿®æ”¹æ—¶é—´",dataIndex:"lastOpTime"},{title:"åˆ›å»ºæ—¶é—´",dataIndex:"createDate"},{title:"Action",key:"action"}]),l=Q({selectedRowKeys:[],selectedRows:[],loading:!1});k([]);const U=k(!1),Z=k(0),M=k({}),j=k(!1),V=k(!1),y=k(void 0),O=k([]);ne(y,()=>{console.log("eNum-watch>>>",y.value),y?(l.selectedRows=O.value.slice(0,y.value),l.selectedRowKeys=l.selectedRows.map(i=>i.id)):(l.selectedRows=[],l.selectedRowKeys=[])});function x(){l.selectedRows=[],l.selectedRowKeys=[];const i={pageSize:1e3,pageNum:1,mediaType:"0",folderId:String(s.value),iconOption:"5",orderBy:"filename",descending:!1};l.loading=!0,z.getListFiles(i).then(e=>{console.log("ðŸš€ ~ API.getlistFiles ~ res:",e),Z.value=e.fileListAO.count;const R=e.fileListAO.folderList.map(C=>({...C,isFolder:!0})),w=e.fileListAO.fileList.map(C=>({...C,isFolder:!1}));O.value=[...R,...w]}).finally(()=>{l.loading=!1})}ne(s,i=>{x()},{immediate:!0});function D(i){console.log("ðŸš€ ~ handleRenameFile ~ record:",i),M.value=i,j.value=!0}function A(i){const e=i.map(w=>({fileId:w.id,fileName:w.name,isFolder:w.fileCata})),R={type:"DELETE",taskInfos:JSON.stringify(e),targetFolderId:""};l.loading=!0,z.createBatchTask(R).then(w=>{B.success("åˆ é™¤æˆåŠŸ"),x()}).finally(()=>{l.loading=!1})}function K(i,e){console.log("targetFolderInfo>>",i.id),e||(e=l.selectedRows);const R=e.map(C=>({fileId:C.id,fileName:C.name,isFolder:C.fileCata})),w={type:"MOVE",taskInfos:JSON.stringify(R),targetFolderId:i.id};l.loading=!0,z.createBatchTask(w).then(C=>{l.selectedRowKeys=[],l.selectedRows=[],B.success("ç§»åŠ¨æˆåŠŸ"),x()}).finally(()=>{l.loading=!1})}const u=(i,e)=>{console.log("selectedRows changed: ",e),l.selectedRowKeys=i,l.selectedRows=e},n=()=>{const i={fileId:String(s.value)};z.getFullPath(i).then(e=>{console.log("handleFullPath-res >>>",e);let R=e.path.map(w=>({id:w.fileId,name:w.fileName}));a.value=R})},T=i=>{i.isFolder&&(s.value=i.id,a.value.push(i))},W=i=>{s.value=i.id;const e=a.value.findIndex(R=>R.id===i.id);e!==-1&&(a.value=a.value.slice(0,e+1))};return(i,e)=>{const R=p("a-breadcrumb-item"),w=p("a-breadcrumb"),C=p("a-input-number"),X=p("a-space"),P=p("a-button"),f=p("a-menu-item"),L=p("a-menu"),pe=p("a-dropdown"),fe=p("a-divider"),ve=p("a-table");return _(),g("div",Je,[c("div",Ge,[c("div",Qe,[t(w,null,{default:o(()=>[(_(!0),g(J,null,Y(a.value,v=>(_(),oe(R,{onClick:I=>W(v),key:v.id},{default:o(()=>[c("a",{class:be([s.value===v.id?"active":""])},N(v.name),3)]),_:2},1032,["onClick"]))),128))]),_:1})]),c("div",We,[t(X,null,{default:o(()=>[c("div",Xe,[e[9]||(e[9]=h(" é›†æ•°ï¼š ")),t(C,{value:y.value,"onUpdate:value":e[0]||(e[0]=v=>y.value=v)},null,8,["value"])]),c("div",null,"æ–‡ä»¶æ•°:"+N(Z.value),1),c("div",{onClick:S},[e[10]||(e[10]=h(" ç›®å½•IDï¼š")),c("a",null,N(s.value),1)])]),_:1}),t(X,null,{default:o(()=>[t(P,{type:"primary",onClick:x,icon:q($(ae))},{default:o(()=>e[11]||(e[11]=[h("åˆ·æ–°")])),_:1},8,["icon"]),t(P,{type:"primary",onClick:e[1]||(e[1]=v=>V.value=!0),icon:q($(we))},{default:o(()=>e[12]||(e[12]=[h("æ–°å»ºæ–‡ä»¶å¤¹")])),_:1},8,["icon"]),t(P,{type:"primary",onClick:e[2]||(e[2]=v=>F.value=!0),icon:q($(G))},{default:o(()=>e[13]||(e[13]=[h(" æ‰¹é‡é‡å‘½å ")])),_:1},8,["icon"]),t(P,{type:"primary",onClick:e[3]||(e[3]=v=>U.value=!0),icon:q($(G))},{default:o(()=>e[14]||(e[14]=[h(" æ‰¹é‡ç§»åŠ¨ ")])),_:1},8,["icon"]),t(P,{type:"primary",onClick:e[4]||(e[4]=v=>A(l.selectedRows)),icon:q($(de))},{default:o(()=>e[15]||(e[15]=[h(" æ‰¹é‡åˆ é™¤ ")])),_:1},8,["icon"]),t(P,{type:"primary",onClick:n,icon:q($(G))},{default:o(()=>e[16]||(e[16]=[h(" èŽ·å–è·¯å¾„")])),_:1},8,["icon"])]),_:1})]),t(ve,{columns:b.value,dataSource:O.value,loading:l.loading,pagination:!1,"row-selection":{selectedRowKeys:l.selectedRowKeys,onChange:u},scroll:{y:"clac(100% - 100px)"},rowKey:"id"},{bodyCell:o(({column:v,record:I})=>[v.dataIndex==="name"?(_(),g("span",{key:0,class:"file-name",onClick:ee=>T(I)},[t(pe,{trigger:["contextmenu"]},{overlay:o(()=>[t(L,null,{default:o(()=>[t(f,{key:"1",onClick:ee=>D(I)},{default:o(()=>[t($(G)),e[17]||(e[17]=h("é‡å‘½å "))]),_:2},1032,["onClick"]),t(f,{key:"2",onClick:ee=>A([I])},{default:o(()=>[t($(de)),e[18]||(e[18]=h("åˆ é™¤ "))]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[c("span",null,[I.isFolder?(_(),g("img",Ze)):H("",!0),h(" "+N(I.name),1)])]),_:2},1024)],8,Ye)):H("",!0),v.dataIndex==="size"?(_(),g(J,{key:1},[I.size?(_(),g("span",tt,N($(ye)(I.size)),1)):(_(),g("span",et,"æ–‡ä»¶å¤¹"))],64)):H("",!0),v.dataIndex==="lastOpTime"?(_(),g("span",nt,N($(ke)(I.lastOpTime).fromNow()),1)):H("",!0),v.key==="action"?(_(),g("span",lt,[c("a",{onClick:ee=>D(I)},"é‡å‘½å",8,ot),t(fe,{type:"vertical"}),c("a",{onClick:ee=>A([I])},"åˆ é™¤",8,at)])):H("",!0)]),_:1},8,["columns","dataSource","loading","row-selection"]),t(Me,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=v=>j.value=v),record:M.value,onUpdate:x},null,8,["modelValue","record"]),t(He,{modelValue:F.value,"onUpdate:modelValue":e[6]||(e[6]=v=>F.value=v),selectedRows:l.selectedRows,onUpdate:x},null,8,["modelValue","selectedRows"]),t(Oe,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=v=>V.value=v),parentFolderId:s.value,onUpdate:x},null,8,["modelValue","parentFolderId"]),t(Re,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=v=>U.value=v),onOk:K,breadcrumb:a.value},null,8,["modelValue","breadcrumb"])])])}}},dt=Ce(st,[["__scopeId","data-v-84b5a912"]]),rt={class:"app-container"},vt=he({__name:"index",setup(m){const d=k({id:le,name:"æˆ‘çš„ç½‘ç›˜"});return(r,a)=>(_(),g("div",rt,[t(dt,{FolderId:d.value.id},null,8,["FolderId"])]))}});export{vt as default};
