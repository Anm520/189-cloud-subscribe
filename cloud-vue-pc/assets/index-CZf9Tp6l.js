import{r as c,q,j as o,f as S,c as a,d as U,n as u,H as F,b as T,e as s,A as k,o as l,g as i,v as G,x as f,P as J,k as C,t as y,y as V,S as Q,J as W,K as X,h,L as Z,M as ee,G as te}from"./index-DVWsMLSs.js";import{N as ae}from"./NewTaskModel-DyAcOs3n.js";import"./useDayjs-25f8CHyX.js";import{u as ne}from"./CloudDisk-CFN3zckg.js";import{_ as le,e as oe}from"./FileUpload-SWJGgt_N.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BUYeriUm.js";import"./FolderTreeModel-B5amu0cV.js";const ie={class:"app-container"},ue={class:"table-top"},de={style:{display:"flex"}},re={style:{display:"flex","margin-right":"10px","align-items":"center"}},pe=["href"],ce={key:1},ve=["onClick"],me={key:0},_e={key:1},ke={key:2},fe={__name:"index",setup(ye){const g=c(!1),A=c(!0),E=c(),z=t=>{E.value=t,console.log("editRecord>>>>",E.value),A.value=!1,g.value=!0},m=c(!1),$=c(""),B=t=>{ee.confirm({title:"删除确认",icon:a(te),content:a("div",{style:"color:red;"},`是否要删除任务： 《${t.task_name}》 ？`),okText:"删除",okButtonProps:{size:"small"},cancelButtonProps:{size:"small"},onOk(){return m.value=!0,k.deleteTask({list:[t.id]}).then(e=>{h.success("删除成功"),r()}).catch(e=>{m.value=!1})},onCancel(){}})},w=c([]),M=c([{title:"序号",dataIndex:"serial"},{title:"任务名称",dataIndex:"task_name"},{title:"任务状态",dataIndex:"status"},{title:"当前集数",dataIndex:"episode"},{title:"总集数",dataIndex:"episode_total"},{title:"保存目录ID",dataIndex:"save_path_id"},{title:"更新时间",dataIndex:"update_time"},{title:"创建帐号",dataIndex:"account"},{title:"操作",dataIndex:"operate"}]),v=c({current:1,pageSize:15,total:0,showTotal:t=>`共计 ${t} 条`}),r=()=>{m.value=!0;const t={current:v.value.current,pageSize:v.value.pageSize,task_name:$.value};k.getTaskList(t).then(e=>{console.log("🚀 ~ .then ~ res:",e),w.value=e.data,v.value.total=e.total}).finally(()=>{m.value=!1})},D=()=>{v.value.current=1,r()},L=({current:t})=>{console.log("pagination>>>>",t),v.value.current=t,r()};ne();const O=t=>{m.value=!0,k.runTask({id:t.id}).then(e=>{console.log("🚀 ~ .handleExecute ~ res:",e);let _=e.successedCount?`成功更新${e.successedCount}个文件`:e.res_message;h.success(_),setTimeout(()=>{r()},10)}).finally(()=>{m.value=!1})},I=c(!1),N=t=>{let e="";t=="account"&&(e=window.localStorage.getItem("account")),I.value=!0,k.runAllTask({account:e}).then(_=>{r(),h.success(_.res_message)}).finally(()=>{I.value=!1})};q(()=>{r()});const R=()=>{k.getAllTaskList().then(t=>{console.log("导出所有数据>>",t),oe.exportToExcel(t,"任务列表.xlsx")})},Y=t=>{console.log("导入的数据",t);let e=[];t.forEach(_=>{e.push(k.createTask(_))}),Promise.all(e).finally(()=>{h.success("导入成功"),r()})},H=t=>{Z.push({path:"/cloud/index",query:{path:t}})};return(t,e)=>{const _=T("a-input"),p=T("a-button"),P=T("a-space"),K=T("a-table");return l(),o("div",ie,[S("div",ue,[S("div",de,[S("div",re,[e[5]||(e[5]=S("span",null," 任务名称：",-1)),a(_,{value:$.value,"onUpdate:value":e[0]||(e[0]=n=>$.value=n),"allow-clear":"",style:{width:"180px"},onKeyup:F(D,["enter"])},null,8,["value"])]),a(p,{type:"primary",onClick:D},{default:s(()=>e[6]||(e[6]=[i("搜索")])),_:1})]),a(P,null,{default:s(()=>[a(p,{type:"primary",onClick:r},{default:s(()=>e[7]||(e[7]=[i("刷新")])),_:1}),a(p,{type:"primary",onClick:e[1]||(e[1]=n=>N("")),loading:I.value},{default:s(()=>e[8]||(e[8]=[i("全部执行")])),_:1},8,["loading"]),a(p,{type:"primary",onClick:e[2]||(e[2]=n=>N("account")),loading:I.value},{default:s(()=>e[9]||(e[9]=[i("执行当前账号")])),_:1},8,["loading"]),a(p,{type:"primary",onClick:R},{default:s(()=>e[10]||(e[10]=[i("导出任务")])),_:1}),a(le,{onOk:Y}),a(p,{icon:G(f(J)),type:"primary",onClick:e[3]||(e[3]=n=>{g.value=!0,A.value=!0})},{default:s(()=>e[11]||(e[11]=[i("新建任务")])),_:1},8,["icon"])]),_:1})]),a(K,{columns:M.value,dataSource:w.value,loading:m.value,pagination:v.value,onChange:L},{bodyCell:s(({column:n,record:x,index:j,text:d})=>[n.dataIndex==="task_name"?(l(),o(C,{key:0},[x.share_url?(l(),o("a",{key:0,href:x.share_url,target:"_blank"},y(d),9,pe)):(l(),o("span",ce,y(d),1))],64)):u("",!0),n.dataIndex==="save_path_id"?(l(),o("a",{key:1,onClick:b=>H(d)},y(d),9,ve)):u("",!0),n.dataIndex==="serial"?(l(),o(C,{key:2},[i(y((v.value.current-1)*v.value.pageSize+j+1),1)],64)):u("",!0),n.dataIndex==="create_time"?(l(),o(C,{key:3},[i(y(d?f(V)(d).format("YYYY-MM-DD HH:mm:ss"):""),1)],64)):u("",!0),n.dataIndex==="update_time"?(l(),o(C,{key:4},[i(y(f(V)(d).fromNow()),1)],64)):u("",!0),n.dataIndex==="status"?(l(),o(C,{key:5},[d===f(Q)?(l(),o("span",me,"执行")):u("",!0),d===f(W)?(l(),o("span",_e,"暂停")):u("",!0),d===f(X)?(l(),o("span",ke,"完结")):u("",!0)],64)):u("",!0),n.dataIndex==="operate"?(l(),U(P,{key:6},{default:s(()=>[a(p,{onClick:b=>O(x)},{default:s(()=>e[12]||(e[12]=[i("执行")])),_:2},1032,["onClick"]),a(p,{onClick:b=>z(x)},{default:s(()=>e[13]||(e[13]=[i("编辑")])),_:2},1032,["onClick"]),a(p,{onClick:b=>B(x)},{default:s(()=>e[14]||(e[14]=[i("删除")])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:1},8,["columns","dataSource","loading","pagination"]),g.value?(l(),U(ae,{key:0,modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=n=>g.value=n),isAdd:A.value,record:E.value,onUpdate:r},null,8,["modelValue","isAdd","record"])):u("",!0)])}}},Ee=se(fe,[["__scopeId","data-v-4e0c454e"]]);export{Ee as default};
